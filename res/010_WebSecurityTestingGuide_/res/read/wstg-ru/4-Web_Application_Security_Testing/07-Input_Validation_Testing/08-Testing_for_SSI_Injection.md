---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование SSI-инъекций

|ID          |
|------------|
|WSTG-INPV-08|

## Обзор

Web-серверы обычно дают разработчикам возможность добавлять небольшие фрагменты динамического кода внутрь статичных HTML-страниц без необходимости иметь дело с полноценными серверными или клиентскими языками. Эта функция предоставляется включениями на стороне сервера (англ.: [Server-Side Includes](https://owasp.org/www-community/attacks/Server-Side_Includes_%28SSI%29_Injection), SSI).

Включения на стороне сервера — это директивы, которые web-сервер анализирует перед отправкой страницы пользователю. Они представляют собой альтернативу написанию [CGI](https://ru.wikipedia.org/wiki/CGI)-программ или встраиванию кода с использованием серверных скриптовых языков, когда требуется выполнять только очень простые задачи. Распространённые реализации SSI предоставляют собой директивы (команды) для включения внешних файлов, для установки и печати переменных среды CGI web-сервера или для выполнения внешних CGI-скриптов или команд операционной системы.

SSI может привести к удалённому выполнению команд (RCE), однако на большинстве web-серверов директива `exec` по умолчанию отключена.

Это уязвимость, очень похожая на классическую уязвимость инъекции скриптового языка. Одним из смягчающих факторов является то, что web-сервер должен быть настроен для разрешения SSI. С другой стороны, уязвимости для SSI-инъекций часто проще эксплуатировать, поскольку директивы SSI просты для понимания и в то же время достаточно мощны, например, они могут выводить содержимое файлов и выполнять системные команды.

## Задачи тестирования

- Найти точки для инъекции SSI.
- Оценить последствия от инъекции.

## Как тестировать

Чтобы проверить, можно ли эксплуатировать SSI, введите директивы SSI в качестве пользовательского ввода. Если SSI включен и проверка пользовательского ввода должным образом не реализована, сервер выполнит директиву. Это очень похоже на классическую уязвимость при инъекции скриптового языка в том смысле, что она возникает, когда пользовательский ввод должным образом не проверяется и не нейтрализуется.

Сначала определите, поддерживает ли web-сервер директивы SSI. Часто ответ положительный, так как поддержка SSI довольно распространена. Чтобы определить, поддерживаются ли директивы SSI, определите тип web-сервера, на котором работает цель, используя методы сбора информации (см. [Определение web-сервера](../01-Information_Gathering/02-Fingerprint_Web_Server.md)). Если у вас есть доступ к коду, определите, используются ли директивы SSI, выполнив поиск в файлах конфигурации web-сервера по определённым ключевым словам.

Другой способ убедиться, включены ли директивы SSI, — проверить наличие страниц с расширением `.shtml`, которое связано с директивами SSI. Использование расширения `.shtml` не является обязательным, поэтому отсутствие файлов `.shtml` не обязательно означает, что цель не уязвима для атак с SSI.

Следующим шагом является определение всех возможных векторов пользовательского ввода и проверка возможности эксплуатации SSI-инъекции.

Сначала найдите все страницы, на которых разрешён пользовательский ввод. Возможные входные векторы могут также включать заголовки и cookie. Определите, как хранятся и используются входные данные, т.е. выдаются ли они в виде сообщения об ошибке или элемента страницы и изменяются ли они каким-либо образом. Доступ к исходному коду может помочь определить, где находятся входные векторы и как обрабатываются входные данные.

Как только у вас будет список потенциальных точек ввода, вы сможете определить, правильно ли проверены входные данные. Убедитесь, что можно вводить символы, используемые в директивах SSI, такие как `<!#=/."->` и `[a-zA-Z0-9]`

В приведенном ниже примере возвращается значение переменной. Раздел [ссылок](#ссылки) содержит полезные ссылки на документацию по конкретным серверам.

```html
<!--#echo var="VAR" -->
```

При использовании директивы `include` , если предоставленный файл является CGI-скриптом, эта директива будет включать выходные данные CGI-скрипта. Эта директива также может использоваться для включения содержимого файла или списка файлов в каталоге:

```html
<!--#include virtual="FILENAME" -->
```

Чтобы показать вывод команды ОС:

```html
<!--#exec cmd="OS_COMMAND" -->
```

Если приложение уязвимо, вводится директива; она будет интерпретирована сервером при следующем просмотре страницы.

Директивы SSI также могут быть вставлены в HTTP-заголовки, если web-приложение использует эти данные для создания динамически генерируемой страницы:

```http
GET / HTTP/1.1
Host: www.example.com
Referer: <!--#exec cmd="/bin/ps ax"-->
User-Agent: <!--#include virtual="/proc/version"-->
```

## Инструменты

- [Web Proxy Burp Suite](https://portswigger.net/burp/communitydownload)
- [OWASP ZAP](https://www.zaproxy.org/)
- [String searcher: grep](https://www.gnu.org/software/grep)

## Ссылки

- [Nginx SSI module](http://nginx.org/en/docs/http/ngx_http_ssi_module.html)
- [Apache: Module mod_include](https://httpd.apache.org/docs/current/mod/mod_include.html)
- [IIS: Server Side Includes directives](https://docs.microsoft.com/en-us/previous-versions/iis/6.0-sdk/ms525185%28v=vs.90%29)
- [Apache Tutorial: Introduction to Server Side Includes](https://httpd.apache.org/docs/current/howto/ssi.html)
- [Apache: Security Tips for Server Configuration](https://httpd.apache.org/docs/current/misc/security_tips.html#ssi)
- [SSI Injection instead of JavaScript Malware](https://jeremiahgrossman.blogspot.com/2006/08/ssi-injection-instead-of-javascript.html)
- [IIS: Notes on Server-Side Includes (SSI) syntax](https://blogs.iis.net/robert_mcmurray/archive/2010/12/28/iis-notes-on-server-side-includes-ssi-syntax-kb-203064-revisited.aspx)
- [Header Based Exploitation](https://www.cgisecurity.com/papers/header-based-exploitation.txt)
