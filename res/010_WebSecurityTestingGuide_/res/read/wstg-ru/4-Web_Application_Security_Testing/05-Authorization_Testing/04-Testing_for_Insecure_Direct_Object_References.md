---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование небезопасных прямых ссылок на объекты (IDOR)

|ID          |
|------------|
|WSTG-ATHZ-04|

## Обзор

Небезопасные прямые ссылки на объекты (англ.: Insecure Direct Object References, IDOR) возникают, когда приложение предоставляет прямой доступ к объектам на основе введённых пользователем данных. В результате этой уязвимости злоумышленники могут обойти авторизацию и получить прямой доступ к ресурсам системы, например к записям базы данных или файлам.
Небезопасные прямые ссылки на объекты позволяют обходить авторизацию и получать доступ к ресурсам напрямую, изменяя значение параметра, используемого для прямого указания на объект. Такими ресурсами могут быть записи базы данных, принадлежащие другим пользователям, файлы в системе и др. Это вызвано тем, что приложение проводит недостаточно строгую авторизацию, принимая введённые пользователем данные и используя их для извлечения объекта.

## Задачи тестирования

- Найти точки с прямыми ссылками на объекты.
- Оценить меры контроля доступа и их уязвимость для IDOR.

## Как тестировать

Чтобы проверить наличие этой уязвимости, сначала необходимо нанести на схему приложения все точки, где для прямых ссылок на объекты ожидается ввод данных от пользователя. Например, там, где пользователь должен что-то ввести для доступа к записи в базе данных, к файлу, к страницам приложений и т.д. Затем, изменяя значение параметров в ссылке на объекты, необходимо оценить, можно ли увидеть объекты, принадлежащие другим пользователям, или иным образом обойти авторизацию.

Лучший способ проверить наличие прямых ссылок на объекты — иметь по крайней мере двух (часто больше) пользователей для охвата различных принадлежащих им объектов и функций. Например, два пользователя, каждый из которых имеет доступ к разным объектам (таким как информация о покупках, личные сообщения и т.д.), и (если применимо) пользователя с отличающимися привилегиями (например, администратора), чтобы увидеть, есть ли прямые ссылки на функциональность приложения. Имея несколько пользователей, экономится драгоценное время на перебор имён объектов, поскольку можно попытаться получить доступ к объектам, принадлежащим другому пользователю.

Ниже приведены несколько типичных сценариев для этой уязвимости и методы тестирования для каждого из них:

### Значение параметра используется непосредственно для извлечения записи из базы данных

Пример запроса:

```text
http://foo.bar/somepage?invoice=12345
```

В этом случае значение параметра *invoice* используется как индекс в таблице счетов в базе данных. Приложение принимает значение этого параметра и использует его в запросе к базе данных. Затем приложение возвращает информацию о счёте пользователю.

Поскольку значение *invoice* входит в сам запрос, путём изменения значения этого параметра можно получить любой объект счета, независимо от пользователя, которому этот счёт принадлежит. Для проверки этого случая необходимо найти идентификатор счёта, принадлежащего другому тестовому пользователю (убедившись, что он не должен просматривать эту информацию согласно бизнес-логике приложения), а затем проверить, возможен ли доступ к объектам без авторизации.

### Значение параметра используется непосредственно для выполнения операции в системе

Пример запроса:

```text
http://foo.bar/changepassword?user=someuser
```

В этом случае значение параметра `user` используется, чтобы сообщить приложению, для какого пользователя следует изменить пароль. Во многих случаях этот шаг будет входить в состав мастера или многошаговой операцией. На первом этапе приложение получит запрос о том, для какого пользователя необходимо изменить пароль, а на следующем этапе пользователь предоставит новый пароль (не спрашивая текущего).

Параметр `user` используется для прямой ссылки на объект пользователя, для которого будет выполнена операция смены пароля. Чтобы проверить этот случай, тестировщик должен попытаться ввести другое тестовое имя пользователя, отличного от того, который в данный момент вошёл в систему, и проверить, возможно ли изменить пароль другого пользователя.

### Значение параметра используется непосредственно для доступа к ресурсам файловой системы

Пример запроса:

```text
http://foo.bar/showImage?img=img00011.jpg
```

В этом случае значение параметра `img` используется, чтобы сообщить приложению, какой файл пользователь намеревается получить. Указав имя или идентификатор другого файла (например, img=img00012.jpg), злоумышленник сможет получить объекты, принадлежащие другим пользователям.

Чтобы протестировать этот случай, тестировщик должен получить ссылку, к которой пользователь не должен иметь доступа, и попытаться получить к ней доступ, используя ее в качестве значения параметра `img`. Примечание: эта уязвимость часто используется в сочетании с уязвимостью обхода каталога/пути (см. [Тестирование включения файлов при обходе каталогов](01-Testing_Directory_Traversal_File_Include.md))

### Значение параметра используется непосредственно для доступа к функциям приложения

Пример запроса:

```text
http://foo.bar/accessPage?menuitem=12
```

В этом случае значение параметра `menuitem` используется, чтобы сообщить приложению, к какому пункту меню (и, следовательно, к какой функциональности) пользователь пытается получить доступ. Предположим, что пользователь имеет ограниченный доступ, т.е. ему доступны только ссылки для доступа к пунктам меню 1, 2 и 3. Изменяя значение параметра `menuitem`, можно обойти авторизацию и получить доступ к дополнительным возможностям приложения. Чтобы проверить этот случай, тестировщик находит то место, где функциональность приложения определяется ссылкой на элемент меню, сопоставляет значения элементов меню, к которым может получить доступ данный тестовый пользователь, а затем пытается использовать другие элементы меню.

В приведённых выше примерах достаточно изменить один параметр. Однако иногда ссылка на объект может быть разделена между более чем одним параметром, и тестирование должно быть соответствующим образом скорректировано.

## Ссылки

OWASP Top 10: 
- [A4:2013 Insecure Direct Object References](https://wiki.owasp.org/index.php/Top_10_2013-A4-Insecure_Direct_Object_References) 
- [A5:2017 - Broken Access Control](https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control/)
- [A01:2021 – Broken Access Control](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)
