---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование повышения привилегий

|ID          |
|------------|
|WSTG-ATHZ-03|

## Обзор

В этом разделе описывается проблема повышения привилегий с одного уровня на другой (эскалации). На этом этапе тестировщик должен убедиться, что пользователь не может изменить свои привилегии или роли внутри приложения таким образом, чтобы это могло привести к атакам с повышением привилегий.

Повышение привилегий происходит, когда пользователь получает доступ к большему количеству ресурсов или функциональных возможностей, чем ему разрешено, и такое повышение или изменения должны были быть предотвращены приложением. Обычно это вызвано недостатками приложения. В результате приложение выполняет действия с большими привилегиями, чем те, которые предусмотрены разработчиком или системным администратором.

Степень эскалации зависит от того, какими привилегиями уполномочен обладать злоумышленник и какие привилегии он сможет получить при успешной атаке. Например, ошибка приложения, которая позволяет пользователю получить дополнительные привилегии после успешной аутентификации, ограничивает степень эскалации, поскольку пользователь уже авторизован для получения некоторых привилегий. А удалённый злоумышленник, получающий привилегии суперпользователя вообще без аутентификации, добивается и более высокой степени эскалации.

Обычно говорят о *вертикальной эскалации*, когда можно получить доступ к ресурсам, предоставленным более привилегированным учётным записям (например, получение прав администратора приложения), и о *горизонтальной эскалации*, когда возможен доступ к ресурсам, предоставленным аналогичной учётной записи (например, в приложении онлайн-банкинга, доступ к информации, относящейся к другому пользователю).

## Задачи тестирования

- Определить точки входа, связанные с манипулированием привилегиями.
- Пофаззить или иным образом попытаться обойти меры защиты.

## Как тестировать

### Тестирование манипулирования ролями/привилегиями

Необходимо отметить все функциональные возможности приложения, где пользователь может создавать информацию в базе данных (например, совершать платежи, добавлять контакты или отправлять сообщения); получать информацию (выписку со счёта, сведения о заказе и т. д.); или удалять её (удалять пользователей, сообщения и т.д.). Тестировщик должен попытаться получить доступ к таким функциям от имени другого пользователя, чтобы проверить, возможен ли доступ к функции, которая не должна быть разрешена его ролью/привилегией (но может быть разрешена от имени другого пользователя).

#### Манипулирование с группой пользователей

Например, следующий HTTP POST позволяет пользователю, принадлежащему к группе `grp001`,  получить доступ к заказу №0001:

```http
POST /user/viewOrder.jsp HTTP/1.1
Host: www.example.com
...

groupID=grp001&orderID=0001
```

Проверьте, может ли пользователь, который не принадлежит к `grp001`,  изменить значение параметров `groupID` и `orderID`, чтобы получить доступ к этим привилегированным данным.

#### Манипулирование с профилем пользователя

Например, следующий ответ сервера показывает скрытое поле в HTML-файле, выдаваемом пользователю после успешной аутентификации:

```http
HTTP/1.1 200 OK
Server: Netscape-Enterprise/6.0
Date: Wed, 1 Apr 2006 13:51:20 GMT
Set-Cookie: USER=aW78ryrGrTWs4MnOd32Fs51yDqp; path=/; domain=www.example.com
Set-Cookie: SESSION=k+KmKeHXTgDi1J5fT7Zz; path=/; domain= www.example.com
Cache-Control: no-cache
Pragma: No-cache
Content-length: 247
Content-Type: text/html
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Connection: close
```
```html
<form  name="autoriz" method="POST" action = "visual.jsp">
<input type="hidden" name="profile" value="SysAdmin">\

<body onload="document.forms.autoriz.submit()">
</td>
</tr>
```

Что будет, если тестировщик изменит значение переменной `profile` на `SysAdmin`? Можно ли стать **администратором**?

#### Манипулирование со значением условия

Например, в окружении, где сервер отправляет сообщение об ошибке, содержащееся в значении определённого параметра в наборе кодов ответа, как показано ниже:

```text
@0`1`3`3``0`UC`1`Status`OK`SEC`5`1`0`ResultSet`0`PVValid`-1`0`0` Notifications`0`0`3`Command  Manager`0`0`0` StateToolsBar`0`0`0`
StateExecToolBar`0`0`0`FlagsToolBar`0
```

 Сервер неявно доверяет пользователю. Он считает, что пользователь ответит вышеуказанным сообщением, закрывающим сессию.

В этом случае убедитесь, что невозможно повысить привилегии, изменив значения параметров. В этом конкретном примере, изменив значение `PVValid` с `-1` на `0` (без ошибок), может оказаться возможным аутентифицироваться в качестве администратора на сервере.

#### Манипуляции с IP-адресом

Некоторые web-сайты ограничивают доступ или подсчитывают количество неудачных попыток входа в систему на основе IP-адреса, например:

```http
X-Forwarded-For: 8.1.1.1
```

В этом случае, если web-сайт использует значение `X-forwarded-For` в качестве IP клиента, тестировщик может изменить значение IP в HTTP-заголовке `X-forwarded-For`, чтобы обойти идентификацию источника по IP.

### Тестирование вертикального обхода схемы авторизации

Вертикальный обход авторизации характерен для случая, когда злоумышленник получает роль выше своей собственной. Тестирование этого обхода направлено на проверку того, как была реализована схема вертикальной авторизации для каждой роли. Для каждой функции, страницы, конкретной роли или запроса, выполняемого приложением, необходимо проверить, возможно ли:

- Получить доступ к ресурсам, которые должны быть доступны только пользователю с более высокими полномочиями.
- Выполнять операции с ресурсами, которые должны выполняться только пользователем с более высокими полномочиями или под особой ролью.

Для каждой роли:

1. Зарегистрируйте пользователя.
2. Установите и поддерживайте две разных сессии для двух разных ролей.
3. Для каждого запроса измените идентификатор сессии с исходного на идентификатор сессии другой роли и анализируйте ответы.
4. Приложение будет считаться уязвимым, если сессия с меньшими привилегиями содержит те же данные или указывает на успешные операции с функциями, что и сессия с более высокими привилегиями.

#### Сценарий тестирования ролей для сайта банка

В следующей таблице показаны системные роли на сайте банка. Каждая роль связана с определёнными разрешениями для работы в меню событий:

|      Роль     |     Разрешения    | Дополнительные разрешения |
|---------------|-------------------|-----------------------|
| Администратор | Полный контроль      | Удаление                |
| Руководитель       | Изменение, Добавление, Чтение | Добавление                   |
| Сотрудник         | Чтение, Изменение      | Изменение                |
| Клиент      | Только чтение         |                       |

Приложение будет считаться уязвимым, если:

1. Клиент может выполнять функции администратора, руководителя или сотрудника банка;
2. Сотрудник может выполнять функции руководителя или администратора;
3. Руководитель может выполнять функции администратора.

Предположим, что функция `deleteEvent` входит в меню учётной записи администратора приложения, и получить к ней доступ можно, запросив следующий URL: `https://www.example.com/account/deleteEvent`. Тогда при вызове функции `deleteEvent` формируется следующий HTTP-запрос:

```http
POST /account/deleteEvent HTTP/1.1
Host: www.example.com
[другие HTTP-заголовки]
Cookie: SessionID=ADMINISTRATOR_USER_SESSION

EventID=1000001
```

Ответом будет:

```http
HTTP/1.1 200 OK
[другие HTTP-заголовки]

{"message": "Event was deleted"}
```

Злоумышленник может попытаться выполнить тот же запрос:

```http
POST /account/deleteEvent HTTP/1.1
Host: www.example.com
[другие HTTP-заголовки]
Cookie: SessionID=CUSTOMER_USER_SESSION

EventID=1000002
```

Если ответ на запрос злоумышленника тоже содержит `{"message": "Event was deleted"}`, то приложение уязвимо.

#### Доступ к странице администратора

Предположим, что в учётную запись администратора входит доступ к меню (панели) администратора.

Приложение будет считаться уязвимым, если какая-либо роль, кроме администратора, сможет получить доступ к этому меню. Иногда разработчики выполняют проверку авторизации только на уровне графического интерфейса и оставляют функции без проверки авторизации, что потенциально приводит к уязвимостям.

### Обход URL

Попробуйте побродить по сайту и проверить, нет ли на нём страниц без проверки авторизации, например:

```text
/../.././userInfo.html
```

### Белый ящик

Скорее всего, тестировщики или хакеры смогут обойти авторизацию по URL-адресу с помощью методов кодирования URL, если проверка проводится только по неполным совпадениям URL, например:

```text
startswith(), endswith(), contains(), indexOf()
```

### Перебор Session ID

Идентификаторы сессии, алгоритм генерации которых может быть уязвим для атаки методом перебора называют слабыми. Например, если в качестве sessionID на web-сайте используется `MD5(Password + UserID)`, то можно угадать или сгенерировать sessionID других пользователей.

## Ссылки

### Техническое руководство

- [Wikipedia - Повышение привилегий](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%B2%D1%8B%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%B8%D0%B2%D0%B8%D0%BB%D0%B5%D0%B3%D0%B8%D0%B9)

## Инструменты

- [OWASP Zed Attack Proxy (ZAP)](https://www.zaproxy.org)
