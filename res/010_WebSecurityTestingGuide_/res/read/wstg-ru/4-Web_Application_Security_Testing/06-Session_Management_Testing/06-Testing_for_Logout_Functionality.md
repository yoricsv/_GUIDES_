---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование выхода из системы

|ID          |
|------------|
|WSTG-SESS-06|

## Обзор

Завершение сессии является важной частью её жизненного цикла. Сокращение до минимума времени жизни сессионных токенов снижает вероятность успешной атаки с перехватом сессии. Это можно рассматривать как меру защиты от других атак, таких как межсайтовый скриптинг (CSRF) и подделка межсайтовых запросов (XSS). Известно, что такие атаки полагаются на наличие у пользователя аутентифицированной сессии. Отсутствие безопасного завершения сессии только увеличивает поверхность атаки для любой из этих атак.

Для безопасного завершения сессии требуются, по крайней мере, следующие компоненты:

- Наличие элементов управления в интерфейсе пользователя, которые позволяют выйти вручную.
- Завершение сессии по истечении заданного периода бездействия (тайм-аут сессии).
- Правильная деактивация состояния сессии на стороне сервера.

Существует несколько проблем, которые могут помешать эффективному завершению сессии. Для идеального безопасного web-приложения пользователь должен иметь возможность завершить работу в любое время через пользовательский интерфейс. Каждая страница должна содержать кнопку выхода в месте, где она будет хорошо видна. Неоднозначные или запутанные функции выхода могут привести к тому, что пользователь не будет доверять им.

Ещё одна распространенная ошибка при завершении сессии заключается в том, что для сессионного токена на стороне клиента устанавливается новое значение, в то время как состояние на стороне сервера остаётся активным, и его можно использовать повторно, вернув в предыдущее значение сессионный cookie. Иногда пользователю показывается только подтверждающее сообщение без выполнения каких-либо дальнейших действий. Этого следует избегать.

Некоторые фреймворки web-приложений для идентификации вошедшего в систему пользователя полагаются исключительно на сессионный cookie. Идентификатор пользователя включён в (зашифрованное) значение cookie. Сервер приложений не отслеживает сессию на стороне сервера. При выходе из приложения сессионный cookie удаляется из браузера. Однако, поскольку приложение не проводит отслеживания, оно не знает, вышел ли пользователь на самом деле. Таким образом, повторно используя сессионный cookie, можно получить доступ к аутентифицированной сессии. Хорошо известным примером этого является функция аутентификации в формах на ASP.NET .

Пользователи web-браузеров часто не обращают внимания на то, что приложение все ещё открыто, и просто закрывают браузер или вкладку. Web-приложение должно знать об этом поведении и автоматически завершать сессию на стороне сервера через определённое время.

Использование системы единого входа (SSO) вместо схемы аутентификации для конкретного приложения часто приводит к сосуществованию нескольких сессий, которые должны завершаться отдельно. Например, завершение сессии, относящейся к конкретному приложению, не приводит к завершению сессии в системе единого входа. Возврат к порталу единого входа даёт пользователю возможность снова зайти в приложение, из которого незадолго до этого был выполнен выход. С другой стороны, функция выхода из системы единого входа не обязательно приводит к завершению сессии в подключенных приложениях.

## Задачи тестирования

- Оценить пользовательский интерфейс выхода из системы.
- Проанализировать тайм-аут сессии и правильно ли она завершается после выхода из приложения.

## Как тестировать

### Тестирование пользовательского интерфейса выхода из системы

Проверьте наличие и наглядность функции выхода в пользовательском интерфейсе. Для этого просмотрите каждую страницу с точки зрения пользователя, который намеревается выйти из web-приложения.

> Вот некоторые признаки хорошего интерфейса пользователя для выхода из системы:
>
> - Кнопка выхода присутствует на всех страницах web-приложения.
> - Кнопка выхода должна быть быстро найдена пользователем, который хочет выйти из web-приложения.
> - После загрузки страницы кнопка выхода должна быть видна без прокрутки.
> - В идеале кнопка выхода размещается в области страницы, которая с точки зрения браузера постоянна, и на которую не влияет прокрутка.

### Тестирование завершения сессии на стороне сервера

Во-первых, сохраните значения cookie, которые используются для идентификации сессии. Вызовите функцию выхода и наблюдайте за поведением приложения, особенно в отношении сессионных cookie. Попробуйте перейти на страницу, которая видна только в аутентифицированной сессии, например, с помощью кнопки браузера «Назад». Если отображается кешированная версия страницы, используйте кнопку перезагрузки, чтобы обновить страницу с сервера. Если функция выхода приводит к тому, что для сессионных cookie устанавливается новое значение, восстановите их старое значение и перезагрузите страницу из аутентифицированной области приложения. Если эти тесты не выявили уязвимостей на тестируемой странице, попробуйте несколько других страниц, которые считаются критическими с точки зрения безопасности, чтобы убедиться, что завершение сессии правильно распознаётся этими областями приложения.

> Данные, которые должны быть видны только аутентифицированным пользователям, не должны быть видны на проверяемых страницах во время проведения тестов. В идеале при доступе к аутентифицируемым областям после завершения сессии приложение перенаправляется на общедоступную область или на форму входа. Это не обязательно для обеспечения безопасности приложения, но после выхода считается хорошей практикой установка сессионных cookie в новые значения.

### Тестирование тайм-аута сессии

Попробуйте определить тайм-аут сессии, выполняя запросы к странице в аутентифицируемой области web-приложения с возрастающими задержками. Если появляется поведение выхода, используемая задержка приблизительно соответствует значению тайм-аута сессии.

> Те же результаты, что и для описанного выше тестирования завершения сессии на стороне сервера, за исключением выхода, вызванного тайм-аутом бездействия.
>
> Разумное значение тайм-аута сессии зависит от назначения приложения и должно обеспечивать баланс безопасности и удобства использования. В банковских приложениях нет смысла сохранять неактивную сессию более 15 минут. С другой стороны, короткий тайм-аут в wiki или на форуме может раздражать пользователей ненужными запросами на вход при наборе длинных сообщений. Там могут быть приемлемы тайм-ауты в час и более.

### Тестирование завершения сессии в системе единого входа (Single Sign-Off)

Выполните выход из тестируемого приложения. Проверьте, существует ли центральный портал или меню, которые позволяет пользователю снова войти в приложение без аутентификации. Проверьте, требует ли приложение аутентификации пользователя, запрашивается ли URL точки входа в приложение. Войдя в тестируемое приложении выполните выход из системы единого входа. Затем попробуйте получить доступ к аутентифицируемой области тестируемого приложения.

> Ожидается, что вызов функции выхода из web-приложения, подключенного к системе единого входа, или в самой системе единого входа приводит к повсеместному завершению всех сессий. Для получения доступа к приложению после выхода из системы единого входа и подключенного приложения должна требоваться аутентификация.

## Инструменты

- [Burp Suite - Repeater](https://portswigger.net/burp/documentation/desktop/tools/repeater)

## Ссылки

### Технические руководства

- [Атаки на воспроизведение cookie в ASP.NET при использовании аутентификации в формах](https://www.vanstechelman.eu/content/cookie-replay-attacks-in-aspnet-when-using-forms-authentication)
