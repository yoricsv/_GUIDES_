---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование тайм-аута сессии

|ID          |
|------------|
|WSTG-SESS-07|

## Обзор

На этом этапе тестировщики проверяют, что приложение автоматически завершает сессию пользователя в системе, если он бездействует в течение определённого времени, гарантируя, что невозможно «переиспользовать» одну и ту же сессию, и что в кэше браузера не осталось чувствительных данных.

Все приложения должны реализовывать тайм-аут простоя (или бездействия) для сессий. Этот тайм-аут определяет количество времени, в течение которого сессия будет оставаться активной в случае отсутствия действий со стороны пользователя, закрытия и деактивации сессии по истечении определённого периода простоя с момента последнего HTTP-запроса, полученного web-приложением для данного Session ID. Наиболее подходящий тайм-аут должен обеспечивать баланс между безопасностью (более короткий тайм-аут) и удобством использования (более длительный) и в значительной степени зависит от уровня чувствительности данных, обрабатываемых приложением. Например, 60-минутное время выхода из системы для публичного форума может быть приемлемым, но такое же время было бы слишком большим для приложения онлайн-банкинга (где рекомендуется тайм-аут 15 минут максимум). В любом случае, приложение, которое не обеспечивает принудительный выход из системы на основе тайм-аута, следует считать незащищённым, если только такое поведение не обусловлено конкретным функциональным требованием.

Тайм-аут простоя ограничивает вероятность того, что злоумышленник угадает и воспользуется действующим Session ID другого пользователя, и при определённых обстоятельствах может защитить общедоступные компьютеры от повторного использования сессии. Однако, если злоумышленник может перехватить данную сессию, тайм-аут простоя не ограничит его действия, поскольку он может периодически генерировать активность в сессии, чтобы поддерживать её активной дольше.

Управление таймаутом сессии и истечением срока её действия должно выполняться на стороне сервера. Если какие-либо данные, находящиеся под контролем клиента, необходимы для тайм-аута сессии, например, значения в cookie или другие параметры для отслеживания времени (например, количество минут с момента входа), то злоумышленник сможет манипулировать ими, чтобы увеличить продолжительность сессии. Таким образом, приложение должно отслеживать время бездействия на стороне сервера и по истечении тайм-аута автоматически деактивировать сессию текущего пользователя и удалить все данные, хранящиеся на клиенте.

Оба действия должны проводиться аккуратно, чтобы не допустить возникновения уязвимостей, которыми злоумышленник может воспользоваться для получения несанкционированного доступа, если пользователь забудет выйти из приложения. В частности, что касается функции выхода, важно убедиться, что все сессионные токены (например, cookie) должным образом уничтожены или деактивированы, а на стороне сервера применяются надлежащие меры защиты для предотвращения повторного использования сессионных токенов. Если такие действия должным образом не выполняются, злоумышленник сможет воспроизвести эти токены, чтобы «воскресить» сессию законного пользователя и выдать себя за него (эта атака обычно известна как «воспроизведение cookie»). Конечно, смягчающим фактором является то, что злоумышленник должен иметь доступ к этим токенам (которые хранятся на компьютере жертвы), но в ряде случаев это не является невозможным или особенно сложным.

Наиболее распространённым сценарием такого рода атак является общедоступный компьютер, который используется для доступа к некоторой частной информации (например, к web-почте, счёту в онлайн-банке). Если пользователь отходит от компьютера без явного выхода из системы и тайм-аут сессии в приложении не реализован, то злоумышленник может получить доступ к той же учётной записи, просто нажав кнопку «назад» в браузере.

## Задача тестирования

- Убедиться, что установлен жёсткий тайм-аут сессии.

## Как тестирования

### Тестирование методом чёрного ящика

Тот же подход, что и в разделе [Тестирование выхода из системы](06-Testing_for_Logout_Functionality.md), можно применить при измерении времени ожидания выхода из системы.
Методология тестирования очень похожа. Во-первых, необходимо проверить, существует ли тайм-аут, например, войдя в систему и дождавшись срабатывания тайм-аута выхода из системы. Как и в функции выхода из системы, по истечении времени ожидания все сессионные токены должны быть уничтожены или деактивированы.

Затем, если тайм-аут настроен, необходимо понять, применяется ли он клиентом или сервером (или и тем, и другим). Если сессионный cookie не является постоянным (или, в более общем случае, сессионный cookie не хранит данных о времени), можно предположить, что тайм-аут принудительно установлен сервером. Если сессионный cookie содержит какие-то данные, связанные со временем (например, время входа, или время последнего доступа, или дата истечения срока действия постоянного cookie), то возможно, что клиент участвует в применении тайм-аута. В этом случае можно попытаться изменить cookie (если он не защищён криптографически) и посмотреть, что происходит с сессией. Например, можно установить дату истечения срока действия cookie далеко в будущем и посмотреть, можно ли продлить сессию.

Как правило, всё должно проверяться на стороне сервера, и не должно быть возможности, повторно установив сессионные cookie в предыдущие значения, снова получить доступ к приложению.

### Тестирование методом серого ящика

Тестировщик должен проверить, что:

- Функция выхода действительно удаляет все сессионные токены или, по крайней мере, деактивирует их.
- Сервер выполняет надлежащие проверки состояния сессии, запрещая воспроизводить удалённые ранее идентификаторы сессии
- Установлен тайм-аут и он контролируется со стороны серверы. Если сервер считывает срок действия из сессионного токена, отправленного клиентом (что не рекомендуется), то токен должен быть криптографически защищён от подделки.

Обратите внимание, что самое главное, чтобы приложение деактивировало сессию на стороне сервера. Обычно это означает, что код должен вызывать соответствующие методы, например. `HttpSession.invalidate()` в Java или `Session.abandon()` в .NET. Очистка файлов cookie в браузере желательна, но не является строго обязательной, поскольку, если сессия признана недействительной на сервере, наличие cookie в браузере злоумышленнику не поможет.

## Ссылки

### Ресурсы OWASP

- [Памятка по управлению сессиями](https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html)
