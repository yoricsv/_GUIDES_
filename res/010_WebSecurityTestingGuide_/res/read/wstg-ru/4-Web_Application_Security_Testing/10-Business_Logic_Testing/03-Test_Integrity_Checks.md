---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование проверки целостности

|ID          |
|------------|
|WSTG-BUSL-03|

## Обзор

Многие приложения предназначены для отображения различных полей в зависимости от ситуации пользователя, оставляя некоторые входные данные скрытыми. Однако во многих случаях можно передать значения скрытых полей на сервер с помощью прокси. В этих случаях средства контроля на стороне сервера должны быть достаточно интеллектуальными для проведения реляционных и прочих изменений, гарантируя, что к серверу допускаются только корректные данные, соответствующие бизнес-логике пользователя и приложения.

Кроме того, приложение не должно зависеть от неизменяемых элементов интерфейса, раскрывающихся меню или скрытых полей для обработки бизнес-логики, поскольку эти поля не редактируются только в контексте браузеров. Пользователи могут редактировать свои значения с помощью редактора в перехватывающем прокси и попытаться манипулировать бизнес-логикой. Если приложение выдаёт значения, связанные с бизнес-правилами, такими как количество и т.д., в виде нередактируемых полей, оно должно поддерживать их копию на стороне сервера и использовать её для обработки бизнес-логики. Наконец, помимо данных приложения/системы, должна быть защищена от несанкционированного чтения, записи и обновления система ведения журналов событий.

Уязвимости контроля целостности бизнес-логики уникальны тем, что эти случаи неправильного использования индивидуальны для каждого приложения. Если пользователи имеют возможность вносить изменения, они должны обновлять/редактировать только определённые артефакты только в определённое время в соответствии с логикой бизнес-процесса.

Приложение должно быть достаточно интеллектуальным, чтобы контролировать наличие реляционных изменений и не позволять пользователям передавать сразу на сервер информацию, которая недопустима и недостоверна, поскольку она поступила из нередактируемых элементов интерфейса или от пользователь, который не авторизован для отправки через интерфейс. Кроме того, системные артефакты, такие как журналы, должны быть «защищены» от несанкционированного чтения, записи и удаления.

### Пример 1

Представьте себе приложение на ASP.NET с графическим интерфейсом, которое позволяет изменять пароли других пользователей только администратору системы. Пользователь с правами администратора видит поля для ввода имени пользователя и пароля, в то время как другие пользователи их не видят. Однако, если пользователь без прав администратора передаст информацию в поле имени пользователя и пароля через прокси, он может «обмануть» сервер, заставив его поверить, что запрос исходит от пользователя с правами администратора, и изменять пароли других пользователей.

### Пример 2

В большинстве web-приложений есть раскрывающиеся списки, позволяющие пользователям быстро выбрать свою страну, месяц рождения и т.д. Предположим, что приложение «Управление проектами» позволяет пользователям входить в систему и, в зависимости от их привилегий, показывает раскрывающийся список проектов, к которым у них есть доступ. Что произойдёт, если злоумышленник найдёт название чужого проекта, к которому у него не должно быть доступа, и передаст эту информацию через прокси? Даст ли приложение доступ к проекту? У него не должно быть доступа, даже если он пропустил проверку бизнес-логики авторизации.

### Пример 3

Предположим, что инспекция по надзору за транспортными средствами требует, чтобы перед выдачей водительских прав его сотрудник проверял удостоверение личности и информацию по каждому гражданину. На этом этапе бизнес-процесс формирует данные с высоким уровнем целостности, так как она контролируется приложением. Теперь предположим, что приложение перемещается в Интернет, чтобы сотрудники могли работать с его полнофункциональной версией, а граждане могли войти в упрощённое приложение самообслуживания для обновления той или иной информации. На этом этапе злоумышленник может использовать перехватывающий прокси для вставки или редактирования данных, к которым у него не должно быть доступа, например, он может нарушить целостность данных, заявляя, что не был женат, но ввести имя супруги. Этот вид вставки или редактирования недоверенных данных нарушает их целостность и мог быть предотвращён, если бы соблюдалась логика бизнес-процесса.

### Пример 4

Многие системы ведут журнал для целей аудита и устранения неполадок. Но насколько корректна/достоверна информация в этих журналах? Могут ли злоумышленники манипулировать ими намеренно или случайно, нарушая их целостность?

## Задачи тестирования

- Проанализировать проектную документацию на компоненты системы, которые передают, хранят или обрабатывают данные.
- Определить, какие типы данных логически приемлемы для каждого компонента, а от каких система должна защищаться.
- Определить, кому должно быть разрешено изменять или читать эти данные в каждом компоненте.
- Попытаться вставить, изменить или удалить значения данных, используемые каждым компонентом, которые не должны быть разрешены в соответствии с логикой бизнес-процесса.

## Как тестировать

### Специальный метод тестирования 1

- Воспользуйтесь прокси для перехвата HTTP-трафика, ища скрытые поля.
- Если найдено скрытое поле, посмотрите, как оно соотносится с графическим интерфейсом приложения, и начните запрашивать это значение через прокси, передавая разные значения данных, в попытке обойти бизнес-процесс и манипулировать значениями, к которым вы не должны были бы иметь доступа.

### Специальный метод тестирования 2

- Воспользуйтесь прокси для перехвата HTTP-трафик, ища место для вставки информации в области приложения, которые нельзя редактировать.
- Если таковые найдены, сопоставьте их с соответствующими им полями в графическом интерфейсе пользователя, и начните запрашивать эти значения через прокси, передавая разные значения данных, в попытке обойти бизнес-процесс и манипулировать значениями, к которым вы не должны были бы иметь доступа.

### Специальный метод тестирования 3

- Перечислите компоненты приложения или системы, на которые можно воздействовать, например журналы или базы данных.
- Для каждого такого компонента попробуйте прочитать, отредактировать или удалить его данные. Например, если это будут файлы журналов, то тестировщики должны попытаться манипулировать собранными там данными.

## Связанные сценарии тестирования

Все сценарии из раздела [Тестирование контроля входных данных](../07-Input_Validation_Testing/README.md).

## Меры защиты

Приложение должно строго контролировать доступ к данным и артефактам, которые могут быть изменены и прочитаны; и предоставлять его по доверенным каналам передачи, обеспечивающим целостность данных. Следует настроить надлежащее ведение журнала событий для контроля и гарантии отсутствия несанкционированного доступа или модификации.

## Инструменты

- Различные системные/прикладные инструменты, такие как редакторы и инструменты для работы с файлами.
- [OWASP Zed Attack Proxy (ZAP)](https://www.zaproxy.org)
- [Burp Suite](https://portswigger.net/burp)

## Ссылки

- [Implementing Referential Integrity and Shared Business Logic in a RDB](http://www.agiledata.org/essays/referentialIntegrity.html)
- [On Rules and Integrity Constraints in Database Systems](https://www.comp.nus.edu.sg/~lingtw/papers/IST92.teopk.pdf)
- [Use referential integrity to enforce basic business rules in Oracle](https://www.techrepublic.com/article/use-referential-integrity-to-enforce-basic-business-rules-in-oracle/)
- [Maximizing Business Logic Reuse with Reactive Logic](https://dzone.com/articles/maximizing-business-logic)
