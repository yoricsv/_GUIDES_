---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование форматно-логического контроля данных

|ID          |
|------------|
|WSTG-BUSL-01|

## Обзор

Приложение должно гарантировать, что как со стороны клиента, так и на стороне сервера можно ввести только логически корректные данные. Только локальная проверка данных может сделать приложения уязвимыми для серверных инъекций через прокси или при обмене данными с другими системами. Это сложнее, чем просто провести анализ граничных значений (англ.: Boundary Value Analysis, BVA), и в большинстве случаев это недостаточно проконтролировать только в точке входа, обычно требуется проверка какой-либо другой системой.

Например: приложение может запросить ваш номер социального страхования. В BVA приложение должно проверять форматы и семантику введённых данных (значение состоит из девяти цифр, не отрицательное ли оно, не все ли нулевые), но есть и логический контроль. SSN сгруппированы и классифицированы. Этот человек не числится среди умерших? Из какого он региона?

Уязвимости, связанные с контролем бизнес-данных, уникальны тем, что они специфичны для конкретного приложения и отличаются от уязвимостей, связанных с подделкой запросов тем, что они больше касаются семантики данных, а не просто нарушают бизнес-процесс.

Клиентская и серверная части приложения должны контролировать и подтверждать, что данные, которые они хранят, обрабатывают и передают, являются логически допустимыми. Даже если пользователь предоставляет приложению допустимые данные, бизнес-логика может привести к тому, что приложение будет вести себя по-разному в зависимости от этих данных или обстоятельств.

### Пример 1

Предположим, вы управляете сайтом онлайн-магазина, который позволяет заказывать ковры. Пользователь выбирает свой ковёр, вводит размер, производит оплату, клиентское приложение проверяет, что вся введённая информация корректна и допустима в части контактной информации, размера, марки и цвета ковра. У бизнес-логики есть два варианта: если ковёр в наличии, он поставляется непосредственно с вашего склада, а если его у вас нет, делается вызов в систему партнера, и, если он есть там, они отправят заказ со своего склада, а потом вы с ними рассчитываетесь. Что произойдёт, если злоумышленник сможет при наличии товара передать вашему партнёру, что товар отсутствует? Что будет, если злоумышленник сможет вмешаться и передать сообщение на склад партнёра, заказав ковёр без оплаты?

### Пример 2

Многие системы кредитных карт загружают остатки на счетах каждую ночь, чтобы клиенты с утра уже могли расплачиваться суммами ниже определённого порога. Верно и обратное. Если пополню баланс кредитной карты утром, я, возможно, не смогу воспользоваться доступным лимитом вечером. Другой случай, если в течении дня я часто плачу своей кредитной картой в разных местах, то могу превысить свой лимит, если системы принимают решения на основе данных прошлой ночи.

### Пример 3

**[Distributed Denial of Dollar (DDo$)](https://news.hitb.org/content/pirate-bay-proposes-distributed-denial-dollars-attack-ddo):**
Это была кампания, предложенная основателем web-сайта The Pirate Bay против юридической фирмы, которая возбудила уголовное дело против The Pirate Bay. Цель состояла в том, чтобы воспользоваться ошибками в дизайне бизнес-функций и в процессе проверки денежного перевода.

Эта атака была осуществлена путем отправки очень небольших сумм в размере 1 шведской кроны (~0,13 доллара США) в юридическую фирму.
Банковский счет, на который направлялись платежи, имел только 1000 бесплатных переводов, после чего за каждый перевод для владельца счёта взималась надбавка (две кроны). После первой тысячи интернет-транзакций каждое пожертвование в размере 1 кроны юридической фирме фактически обходилось ей в одну крону.

## Задачи тестирования

- Определить точки инъекции данных.
- Убедиться, что все проверки проводятся на серверной части и их нельзя обойти.
- Попытаться нарушить формат ожидаемых данных и проанализировать, как приложение их обрабатывает.

## Как тестировать

### Общая методика тестирования

- Просмотрите проектную документацию и попробуйте выяснить местонахождение точек ввода данных или точек обмена данными между системами или приложениями.
- После обнаружения попробуйте вставить логически недопустимые данные в приложение/систему.

### Специальная методика тестирования

- Проведите функциональное тестирование графического интерфейса клиентской части приложения, чтобы убедиться, что принимаются только «допустимыми» значения.
- Используя перехватывающий прокси, понаблюдайте за HTTP-запросами POST/GET в поисках мест, где передаются такие переменные, как стоимость и количество. В частности, ищите точки обмена между приложениями/системами, которые могут стать возможными точками инъекции или несанкционированного доступа.
- Как только переменные найдены, начинайте опрашивать поле с логически «недопустимыми» данными, такими как номера социального страхования или уникальные идентификаторы, которых не существует или они не соответствуют бизнес-логике. Это тестирование контролирует, что сервер работает корректно и не принимает логически недопустимые данные.

## Связанные сценарии тестирования

- Все сценарии из раздела [Тестирование контроля входных данных](../07-Input_Validation_Testing/README.md).
- [Перебор и угадывание учётных записей пользователей](../03-Identity_Management_Testing/04-Testing_for_Account_Enumeration_and_Guessable_User_Account.md).
- [Тестирование схемы управления сессиями](../06-Session_Management_Testing/01-Testing_for_Session_Management_Schema.md).
- [Тестирование незащищённых параметров сессии](../06-Session_Management_Testing/04-Testing_for_Exposed_Session_Variables.md).

## Меры защиты

Приложение/система должны гарантировать, что они не просто доверяют всем данным, которые попали в систему, а что во всех точках входа и обмена приложения или системы принимаются только «логически допустимые» данные.

## Инструменты

- [OWASP Zed Attack Proxy (ZAP)](https://www.zaproxy.org)
- [Burp Suite](https://portswigger.net/burp)

## Ссылки

- [OWASP Proactive Controls (C5) - Validate All Inputs](https://owasp.org/www-project-proactive-controls/v3/en/c5-validate-inputs) ([перевод](https://github.com/OWASP/www-project-proactive-controls/blob/master/v3/Owasp-top-10-proactive-controls-2018-russian.pdf))
- [OWASP Cheatsheet Series - Input_Validation_Cheat_Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html)
