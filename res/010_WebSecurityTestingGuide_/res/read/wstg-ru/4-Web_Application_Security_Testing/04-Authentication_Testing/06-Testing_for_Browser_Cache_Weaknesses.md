---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование уязвимостей кэша браузера

|ID          |
|------------|
|WSTG-ATHN-06|

## Обзор

На этом этапе тестировщик проверяет, правильно ли приложение инструктирует браузер не сохранять чувствительные данные.

Браузеры могут хранить информацию с целью её кэширования и сбора истории. Кэширование используется для повышения производительности, чтобы загруженную ранее информацию не нужно было загружать снова. Механизмы истории используются для удобства пользователя, поэтому пользователь может видеть именно то, что он видел в момент извлечения ресурса. Если пользователю отображается конфиденциальная информация (например, его адрес, данные банковской карты, индивидуального лицевого счёта или имя пользователя), то эта информация может быть сохранена в целях кэширования или сбора истории и, следовательно, может быть получена путём изучения кэша или просто нажатием кнопки **Назад** в браузере.

## Задачи тестирования

- Проанализировать, не хранит ли приложение конфиденциальную информацию на стороне клиента.
- Проверить, возможен ли доступ к ней без авторизации.

## Как тестировать

### История браузера

Технически кнопка **Назад** — это история, а не кэш (см. [RFC 9111](https://www.rfc-editor.org/rfc/rfc9111#history.lists)). Кэш и история — две разные сущности. Тем не менее, они имеют один и тот же недостаток при выводе отображённой ранее конфиденциальной информации.

Первый и самый простой тест состоит из ввода чувствительной информации в приложение и выхода из системы. Затем тестировщик нажимает кнопку **Назад** в браузере, чтобы проверить, можно ли получить доступ к ранее загруженной информации без аутентификации.

Если, нажав кнопку **Назад**, тестировщик может получить доступ к предыдущим страницам, но не к новым, то это не проблема с аутентификацией, а проблема с историей браузера. Если эти страницы содержат чувствительные данные, это означает, что приложение не запрещало браузеру хранить их.

При тестировании не обязательно должна быть задействована аутентификация. Например, когда пользователь вводит свой адрес электронной почты, чтобы подписаться на рассылку новостей, его можно извлечь, если не обрабатывать должным образом.

Можно запретить показывать конфиденциальные данные по кнопке **Назад**, например:

- доставляя страницу по протоколу HTTPS;
- установив директиву `Cache-Control: must-revalidate`

### Кэш браузера

Здесь тестировщики проверяют, что приложение не пропускает чувствительные данные в кэш браузера. Для этого они могут использовать прокси (например, ZAP) и искать ответы сервера, относящиеся к сессии, проверяя, что для каждой страницы, содержащей чувствительную информацию, сервер дал указание браузеру не кэшировать данные. Такое указание может быть выдано в заголовках HTTP-ответа со следующими директивами:

- `Cache-Control: no-cache, no-store`
- `Expires: 0`
- `Pragma: no-cache`

Этих директив, как правило, достаточно, хотя для заголовка `Cache-Control` могут потребоваться дополнительные флаги, чтобы предотвратить постоянные ссылки на файлы в файловой системе. К ним относятся:

- `Cache-Control: must-revalidate, max-age=0, s-maxage=0`

```http
HTTP/1.1:
Cache-Control: no-cache
```

```http
HTTP/1.0:
Pragma: no-cache
Expires: "past date or illegal value (e.g., 0)"
```

Например, при тестировании приложения для электронной коммерции, необходимо найти все страницы, содержащие номера банковских карт или какую-либо другую финансовую информацию, и проверить, что на всех этих страницах применяется директива `no-cache`. Если найдутся страницы, содержащие чувствительную информацию, но не указывающие браузеру не кэшировать их содержимое, знайте, что чувствительная информация будет сохранена на диске, и в этом можно убедиться, просто отыскав страницу в кэше браузера.

Точное место хранения этой информации зависит от операционной системы клиента и используемого браузера. Вот некоторые примеры:

- Mozilla Firefox:
    - Unix/Linux: `~/.cache/mozilla/firefox/`
    - Windows: `C:\Users\<user_name>\AppData\Local\Mozilla\Firefox\Profiles\<profile-id>\Cache2\`
- Internet Explorer:
    - `C:\Users\<user_name>\AppData\Local\Microsoft\Windows\INetCache\`
- Chrome:
    - Windows: `C:\Users\<user_name>\AppData\Local\Google\Chrome\User Data\Default\Cache`
    - Unix/Linux: `~/.cache/google-chrome`

#### Анализ кэшированной информации

Firefox предоставляет возможность для просмотра кэшированной информации, которая может быть полезна тестировщику. Конечно, существует множество расширений и внешних приложений, которые вы можете предпочесть или которые вам понадобятся для Chrome, Safari или Edge.

Данные о кэше также доступны через Инструменты разработчика в большинстве современных браузеров, таких как [Chrome](https://developers.google.com/web/tools/chrome-devtools/storage/cache), [Edge](https://docs.microsoft.com/microsoft-edge/devtools-guide-chromium/storage/cache), [Safari](https://support.apple.com/guide/safari-developer/welcome/mac) и [Firefox](https://developer.mozilla.org/docs/Tools/Storage_Inspector#Cache_Storage). В Firefox также можно использовать URL `about:cache`, чтобы посмотреть кэш.

#### Проверка обработки кэша в мобильных браузерах

В мобильных браузерах обработка директив кэша может быть совершенно иной. Поэтому тестировщикам следует начинать анализ с новой сессии с чистым кэшем и воспользоваться такими функциями, как Режим устройства (англ.: Device Mode) в [Chrome](https://developer.chrome.com/docs/devtools/device-mode/), Отзывчивый дизайн (англ. Responsive Design Mode) в [Firefox](https://developer.mozilla.org/docs/Tools/Responsive_Design_Mode) или [Safari](https://developer.apple.com/safari/tools/) чтобы протестировать сценарии, описанные выше.

Кроме того, персональные прокси, такие как ZAP и Burp Suite, позволяют указывать, какой агент пользователя (англ.: `User-Agent`) должен передаваться их пауками/сканерами. Его можно установить в значение, соответствующее `User-Agent` мобильного браузера, чтобы проанализировать какие директивы кэширования выдаются тестируемым приложением.

### Тестирование методом серого ящика

Методология тестирования такая же как и в случае с чёрным ящиком, поскольку в обоих сценариях тестировщики имеют полный доступ к заголовкам ответов сервера и к HTML-коду. Однако при тестировании методом серого ящика тестировщик может иметь доступ к учётной записи, которая позволит ему протестировать конфиденциальные страницы, доступные только для прошедших проверку подлинности пользователей.

## Инструменты

- [OWASP Zed Attack Proxy](https://www.zaproxy.org)

## Ссылки

### Технические руководства

- [Кэширование в HTTP](https://datatracker.ietf.org/doc/rfc9111/)
