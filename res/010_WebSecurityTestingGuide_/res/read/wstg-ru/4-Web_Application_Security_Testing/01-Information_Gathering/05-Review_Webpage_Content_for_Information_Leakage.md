---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Анализ контента web-страницы на предмет утечки информации

|ID          |
|------------|
|WSTG-INFO-05|

## Обзор

Программистам часто рекомендуют включать подробные комментарии и метаданные в свой исходный код. Однако комментарии и метаданные, включенные в HTML, могут раскрывать внутреннюю информацию, которая не должна быть доступна потенциальным злоумышленникам. Необходимо провести анализ комментариев и метаданных, чтобы определить, не происходит ли утечка какой-либо информации. Кроме того, некоторые приложения могут раскрывать информацию в теле ответов при перенаправлении.

Для современных web-приложений использование клиентского JavaScript во внешних интерфейсах становится всё более популярным. Например, используются такие технологии как ReactJS, AngularJS или Vue. Подобно комментариям и метаданным в HTML, многие программисты также "зашивают" конфиденциальную информацию в переменные JavaScript. Конфиденциальная информация может включать: закрытые API-ключи (*например,* неограниченный ключ для API Google Map), внутренние IP-адреса, конфиденциальные маршруты (*например* маршрут к скрытым административным страницам или функциям) или даже учётные данные. Эта информация может быть украдена из клиентского JavaScript. Необходимо провести анализ, чтобы определить, не произошла ли утечка конфиденциальной информации, которая может быть использована нарушителем для злоупотреблений.

Для больших web-приложений серьёзную озабоченность вызывают проблемы с производительностью. Для оптимизации используются различные методы, в том числе Syntactically Awesome Style Sheets (SASS), Sassy CSS (SCSS), webpack и т.д. При использовании этих технологий код иногда становится труднее читать и отлаживать. и из-за этого программисты часто развёртывают карты исходного кода (англ.: Source Map) в целях отладки. Карта кода — это специальный файл, который сопоставляет минифицированную версию ресурса (CSS или JavaScript) с исходной авторской версией. Программисты до сих пор спорят о том, следует ли переносить карту кода в среду эксплуатации. Тем не менее, нельзя отрицать, что если они будут в наличии, то сделают код более удобочитаемым. Это может облегчить злоумышленникам поиск уязвимостей или сбор конфиденциальной информации. Необходимо проводить анализ кода JavaScript, чтобы определить, доступны ли клиентам какие-либо файлы отладки. В зависимости от контекста и чувствительности проекта эксперт по безопасности должен решить, должны ли такие файлы быть в промышленной среде или нет.

## Задачи тестирования

- Просмотреть комментарии в разметке web-страниц, метаданные и страницы перенаправления, чтобы обнаружить утечки информации.
- Собрать файлы JavaScript и просмотреть их код, чтобы лучше понять приложение и найти возможные утечки информации.
- Определить наличие в среде эксплуатации карты кода или других файлов отладки.

## Как тестировать

### Просмотр комментариев и метаданных web-страницы

HTML-комментарии часто используются разработчиками для включения отладочной информации о приложении. Иногда о них забывают и оставляют в рабочей среде. Тестировщики должны найти все комментарии HTML, которые начинаются с `<!--`.

Проверьте исходный код HTML на наличие комментариев, содержащих чувствительную информацию, которая может помочь злоумышленнику получить больше информации о приложении. Это может быть SQL-запрос, имена пользователей и пароли, внутренние IP-адреса или отладочная информация.

```html
...
<div class="table2">
  <div class="col1">1</div><div class="col2">Mary</div>
  <div class="col1">2</div><div class="col2">Peter</div>
  <div class="col1">3</div><div class="col2">Joe</div>

<!-- Query: SELECT id, name FROM app.users WHERE active='1' -->

</div>
...
```

Тестировщик может найти даже что-то вроде:

```html
<!-- Use the DB administrator password for testing:  f@keP@a$$w0rD -->
```

Проверьте информацию о версии HTML на наличие актуальных номеров версий и URL-адресов для определения типа данных (DTD).

```html
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
```

- `strict.dtd` — строгое DTD по умолчанию
- `loose.dtd` — свободное DTD
- `frameset.dtd` — DTD для документов с фреймами

Некоторые теги `META` не предоставляют угрозы, но зато позволяют злоумышленнику определить автора:

```html
<META name="Author" content="Andrew Muller">
```

Распространённым (но несовместимым со спецификациями [Web Content Accessibility Guidelines (WCAG)](https://www.w3.org/WAI/standards-guidelines/wcag/) `META`-тегом является [Refresh](https://en.wikipedia.org/wiki/Meta_refresh).

```html
<META http-equiv="Refresh" content="15;URL=https://www.owasp.org/index.html">
```

Обычно тег `META` используется для указания ключевых слов, которые поисковая система может использовать для улучшения качества результатов поиска.

```html
<META name="keywords" lang="en-us" content="OWASP, security, sunshine, lollipops">
```

Хотя большинство web-серверов управляют индексацией поисковых систем посредством файла `robots.txt`, ею также можно управлять с помощью тегов META. Приведенный ниже тег будет рекомендовать роботам не индексировать и не переходить по ссылкам на HTML-странице, содержащей этот тег.

```html
<META name="robots" content="none">
```

Возможности для связывания метаданных с интернет-контентом предоставляет [протокол для описания web-ресурсов (POWDER)](https://www.w3.org/2007/powder/).

### Поиск JavaScript на странице и во внешних файлах

Программисты часто «зашивают» чувствительную информацию в переменных JavaScript в клиентской части. Тестировщики должны проверять HTML-разметку и искать код JavaScript между тегами `<script>` и `</script>`. Также они должны найти все внешние файлы JavaScript для анализа кода (файлы JavaScript имеют расширение `.js`, а имя файла JavaScript обычно указывается в атрибуте `src` (источник) тега `<script>`).

Проверьте код JavaScript на наличие утечек чувствительной информации, которые могут быть использованы злоумышленниками для дальнейшего злоупотребления или манипулирования системой. Ищите такие значения, как: API-ключи, внутренние IP-адреса, пути или учётные данные. Например:

```javascript
const myS3Credentials = {
  accessKeyId: config('AWSS3AccessKeyID'),
  secretAcccessKey: config('AWSS3SecretAccessKey'),
};
```

Тестировщик может найти даже что-то типа:

```javascript
var conString = "tcp://postgres:1234@localhost/postgres";
```

Когда API-ключ найден, тестировщики могут проверить, установлены ли ограничения на этот ключ для каждой службы или по IP-адресу, HTTP-referrer, приложению, SDK и т.д.

Например, если тестировщик нашёл API-ключ Google Map, то он может проверить, ограничен ли этот ключ по IP или только API карт Google. Если ключ ограничен только API, злоумышленники смогут использовать его для неограниченных запросов к API карт Google, и заплатить за это придётся владельцу приложения.

```html

<script type="application/json">
...
{"GOOGLE_MAP_API_KEY":"AIzaSyDUEBnKgwiqMNpDplT6ozE4Z0XxuAbqDi4", "RECAPTCHA_KEY":"6LcPscEUiAAAAHOwwM3fGvIx9rsPYUq62uRhGjJ0"}
...
</script>
```

В некоторых случаях в коде JavaScript тестировщики находят чувствительные пути, например, ссылки, ведущие на внутренние или скрытые интерфейсы администрирования.

```html
<script type="application/json">
...
"runtimeConfig":{"BASE_URL_VOUCHER_API":"https://staging-voucher.victim.net/api", "BASE_BACKOFFICE_API":"https://10.10.10.2/api", "ADMIN_PAGE":"/hidden_administrator"}
...
</script>
```

### Поиск файлов Source Map (карта кода)

Файлы Source Map обычно загружаются при открытии DevTools (Инструментов разработчика). Тестировщик также может найти их, добавив расширение ".map" к расширению каждого внешнего файла JavaScript. Например, если найден файл `/static/js/main.chunk.js`, можно проверить его Source Map, посетив `/static/js/main.chunk.js.map`.

Проверьте карту кода на наличие чувствительной информации, которая может помочь злоумышленнику получить более подробную информацию о приложении. Например:

```json
{
  "version": 3,
  "file": "static/js/main.chunk.js",
  "sources": [
    "/home/sysadmin/cashsystem/src/actions/index.js",
    "/home/sysadmin/cashsystem/src/actions/reportAction.js",
    "/home/sysadmin/cashsystem/src/actions/cashoutAction.js",
    "/home/sysadmin/cashsystem/src/actions/userAction.js",
    "..."
  ],
  "..."
}
```

Когда web-сайты подгружают файлы Source Map, исходный код клиентской части становится читабельным и его легче отлаживать.

### Поиск сообщений при перенаправлении, которые содержат утечки информации

Хотя обычно не ожидается, что сообщения при перенаправлении будут содержать что-либо значимое, нет никакой гарантии, что они его не содержат. Таким образом, хотя http-ответы серии 300 (перенаправление) часто содержат что-то типа "перенаправление на `https://example.com/`" это также может привести к утечке информации.

Рассмотрим ситуацию, в которой сообщение при перенаправлении является результатом аутентификации или авторизации. Если эта процедура не пройдена, сервер может перенаправить пользователя обратно на «безопасную» страницу или страницу по умолчанию, но само сообщение перенаправления может по-прежнему содержать контент, который хотя и не отображается в браузере, но передается клиенту. Его можно увидеть либо с использованием Инструментов разработчика в браузере, либо с помощью обратного прокси-сервера (типа ZAP, Burp, Fiddler или Charles).

## Инструменты

- [Wget](https://www.gnu.org/software/wget/wget.html)
- Функция браузера DevTools (Исходный код страницы)
- Глаза (👀)
- [Curl](https://curl.haxx.se/)
- [Zaproxy](https://www.zaproxy.org)
- [Burp Suite](https://portswigger.net/burp)
- [Waybackurls](https://github.com/tomnomnom/waybackurls)
- [Google Maps API Scanner](https://github.com/ozguralp/gmapsapiscanner/)

## Ссылки

- [KeyHacks](https://github.com/streaak/keyhacks)
- [RingZer0 Online CTF](https://ringzer0ctf.com/challenges/104) - Challenge 104 "Admin Panel".

### Технические стандарты

- [HTML version 4.01](https://www.w3.org/TR/1999/REC-html401-19991224)
- [XHTML](https://www.w3.org/TR/2010/REC-xhtml-basic-20101123/)
- [HTML version 5](https://www.w3.org/TR/html5/)
