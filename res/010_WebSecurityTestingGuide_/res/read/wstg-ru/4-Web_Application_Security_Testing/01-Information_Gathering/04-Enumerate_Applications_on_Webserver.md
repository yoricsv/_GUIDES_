---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Инвентаризация приложений на web-сервере

|ID          |
|------------|
|WSTG-INFO-04|

## Обзор

Важнейшим шагом в тестировании web-приложений на наличие уязвимостей является определение того, какие именно приложения размещены на web-сервере. Многие приложения имеют известные уязвимости и известные стратегии атак, которые можно использовать для получения удалённого управления или несанкционированного использования данных. Кроме того, многие приложения часто не защищаются или не обновляются из-за того, что считается, что они используются только «внутри» и, следовательно, никакой угрозы не существует.

С распространением виртуальных web-серверов традиционное отношение 1:1 между IP-адресом и web-сервером теряют своё исходное значение. Нередко несколько web-сайтов или приложений с разными DNS-именами определяются как один и тот же IP-адрес. Этот сценарий не ограничивается хостинг-провайдерами, он также применим и к обычным корпоративным средам.

Специалистам по безопасности иногда в качестве цели для тестирования даётся набор IP-адресов. Этот сценарий похож на задание типа тестирования на проникновение, но в любом случае ожидается, что будут проанализированы все web-приложения, доступные через эту цель. На данном IP-адресе размещена служба HTTP на порту 80, но если тестировщик захочет получить к нему доступ, указав IP-адрес (а это всё, что он знает), он увидит "No web server configured at this address" или что-то подобное. Система могла «скрыть» ряд web-приложений, относящихся к несвязанным DNS-именам. Очевидно, что область исследования сильно зависит от того, тестируются ли все приложения или только те, о которых известно тестировщику.

Иногда спецификация цели более развёрнута. Тестировщику может быть дан список IP-адресов и соответствующих им DNS-имён. Тем не менее, этот список может передавать неполную информацию, т.к. некоторые DNS-имена могут быть опущены, и клиент может даже не знать об этом (что часто происходит в крупных организациях).

Другие вопросы, влияющие на область исследования, представлены web-приложениями, опубликованными по неочевидным адресам (например, `http://www.example.com/some-strange-URL`), которые нигде больше не упоминаются. Это может произойти либо по ошибке (из-за неправильной настройки), либо намеренно (например, неанонсированные административные интерфейсы).

Чтобы устранить эти проблемы, необходимо провести обнаружение web-приложений.

## Задача тестирования

- Провести инвентаризацию приложений, которые находятся на web-сервере и входят в область исследования.

## Как тестировать

Обнаружение web-приложений — процесс, направленный на идентификацию web-приложений в заданной инфраструктуре. Последняя обычно указывается как набор (блок) IP-адресов, но может состоять из набора DNS-имён или их комбинации. Эта информация передаётся перед проведением исследования, будь то тест на проникновение в классическом стиле или анализ защищённости приложения. В обоих случаях, если в правилах участия не указано иное (например, тестировать только приложение, расположенное по адресу `http://www.example.com/`), оценка должна быть максимально полной по охвату, т.е. должна идентифицировать все приложения, доступные через указанную цель. В следующих примерах рассматривается несколько методов, которые можно применять для этого.

> Некоторые из методов применимы к web-серверам с выходом в Интернет, а именно DNS- и web-поиску с обратным IP. В примерах используются частные IP-адреса (например, `192.168.1.100`), которые, если не указано иное, представляют собой *общие* IP-адреса и используются только в целях анонимности.

Есть три фактора, влияющих на то, сколько приложений связано с данным DNS-именем (или IP-адресом):

1. **Другой базовый URL**

    Очевидной точкой входа для web-приложения является `www.example.com`, т.е. с помощью этой краткой записи мы думаем о web-приложении `http://www.example.com/` (то же относится и к https). Однако, несмотря на то, что это наиболее распространённая ситуация, ничто не мешает приложению начинаться после `/`.

    Например, одно и то же DNS-имя может быть связано с тремя web-приложениями, например:`http://www.example.com/url1` `http://www.example.com/url2` `http://www.example.com/url3`

    В этом случае URL `http://www.example.com/` не будет связан с какой-то значимой страницей, а три приложения будут **скрыты**, если тестировщик явно не знает, как к ним добраться, т.е. не знает *url1*, *url2* или *url3*. Обычно нет необходимости публиковать web-приложения таким образом, только если владелец умышленно не хочет, чтобы они были доступны стандартным образом, и готов отдельно информировать об их точном местонахождении. Это не означает, что эти приложения являются секретными, просто их существование и местонахождение явно не анонсируются.

2. **Нестандартные порты**

    Хотя web-приложения обычно используют порты 80 (http) и 443 (https), в этих номерах портов нет ничего особенного. Фактически, web-приложения могут быть связаны с произвольными TCP-портами, и на них можно ссылаться, указав номер порта следующим образом: `http[s]://www.example.com:port/`. Например, `http://www.example.com:20000/`.

3. **Виртуальные хосты**

    DNS позволяет связать один IP-адрес с одним или несколькими символьными именами. Например, IP-адрес `192.168.1.100` может быть связан с DNS-именами `www.example.com`, `helpdesk.example.com`, `webmail.example.com`. Необязательно, чтобы все имена принадлежали одному и тому же домену DNS. Связь 1:N может использоваться для обслуживания различного контента с помощью так называемых виртуальных хостов. Информация, указывающая виртуальный хост, есть в [заголовке Host](https://tools.ietf.org/html/rfc2616#section-14.23) протокола HTTP.

    Никто бы и не заподозрил о существовании других web-приложений помимо очевидного `www.example.com`, не зная о наличии `helpdesk.example.com` и `webmail.example.com`.

### Подходы к решению проблемы 1 — нестандартные URL-адреса

Нет какого-то способа полностью удостовериться в наличии web-приложений с нестандартными именами. Нет чётких критериев, регулирующих соглашение о наименовании, однако есть ряд методов, которые тестировщик может использовать для получения дополнительной информации.

Во-первых, если web-сервер не настроен правильно, то он позволяет просматривать каталоги, и, возможно, удастся обнаружить эти приложения. С этим могут помочь сканеры уязвимостей.

Во-вторых, на эти приложения могут ссылаться другие web-страницы, и есть вероятность, что они были просканированы и проиндексированы поисковыми системами. Если тестировщики догадываются о существовании таких **скрытых** приложений на `www.example.com`, они могут поискать их с помощью оператора *site* и изучить результат запроса `site: www.example.com`. Среди возвращенных URL-адресов может быть один, указывающий на такое неочевидное приложение.

Другой вариант — проверить URL, которые могут быть вероятными кандидатами для непубличных приложений. Например, внешний интерфейс web-почты может быть доступен по URL-адресам, таким как `https://www.example.com/webmail`, `https://webmail.example.com/`, или `https://mail.example.com/`. То же самое относится и к административным интерфейсам, которые могут быть опубликованы по скрытым URL (например, административный интерфейс Tomcat) и при этом нигде не упоминаться. Таким образом, поиск по словарю (или метод «обоснованного тыка») может дать некоторые результаты. С этим могут помочь сканеры уязвимостей.

### Подходы к решению проблемы 2 — нестандартные порты

Наличие web-приложений на нестандартных портах проверить легко. Сканер портов, например, Nmap, может распознавать службы с помощью опции `-sV`, и идентифицировать http[s] на произвольных портах. Всего то и нужно, что перебрать всё адресное пространство в 64 тысячи TCP-портов.

Например, следующая команда при сканировании TCP-соединений будет искать все открытые порты на IP-адресе `192.168.1.100` и попытается определить, какие службы к ним привязаны (показаны только *основные* переключатели — Nmap имеет широкий набор опций, обсуждение которых выходит за рамки данного руководства):

`nmap –Pn –sT –sV –p0-65535 192.168.1.100`

Достаточно изучить результат её работы и найти http или указание служб, обёрнутых в SSL (которые следует проверить отдельно, чтобы подтвердить, что они являются https). Например, вывод предыдущей команды может выглядеть так:

```bash
Interesting ports on 192.168.1.100:
(The 65527 ports scanned but not shown below are in state: closed)
PORT      STATE SERVICE     VERSION
22/tcp    open  ssh         OpenSSH 3.5p1 (protocol 1.99)
80/tcp    open  http        Apache httpd 2.0.40 ((Red Hat Linux))
443/tcp   open  ssl         OpenSSL
901/tcp   open  http        Samba SWAT administration server
1241/tcp  open  ssl         Nessus security scanner
3690/tcp  open  unknown
8000/tcp  open  http-alt?
8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
```

Из этого примера видно, что:

- На 80-м порту запущен HTTP-сервер Apache.
- Похоже, что на порту 443 есть HTTPS-сервер (но это необходимо подтвердить, например, набрав `https://192.168.1.100` в браузере).
- На порту 901 находится web-интерфейс Samba SWAT.
- Служба на порту 1241 — это не HTTPS, а демон Nessus, обёрнутый в SSL.
- Порт 3690 имеет неуказанную службу (Nmap возвращает её *fingerprint* — здесь опущенный для ясности — вместе с инструкциями как отправить его для включения в базу сигнатур Nmap, при условии, что вы знаете, какую службу он представляет).
- Ещё одна неуказанная служба есть на порту 8000; возможно, это HTTP, поскольку на этом порту нередко можно найти HTTP-серверы. Разберём этот вопрос:

```bash
$ telnet 192.168.10.100 8000
Trying 192.168.1.100...
Connected to 192.168.1.100.
Escape character is '^]'.
GET / HTTP/1.0

HTTP/1.0 200 OK
pragma: no-cache
Content-Type: text/html
Server: MX4J-HTTPD/1.0
expires: now
Cache-Control: no-cache

<html>
...
```

Что подтверждает, что на самом деле это HTTP-сервер. В качестве альтернативы, тестировщики могли бы посетить URL-адрес с помощью web-браузера; или использовать команды GET или HEAD в Perl, которые имитируют HTTP-взаимодействия, подобные приведённым выше (однако запросы HEAD могут поддерживаться не всеми серверами).

- На порту 8080 запущен Apache Tomcat.

Ту же задачу могут выполнять и сканеры уязвимостей, но сначала убедитесь, что выбранный сканер может идентифицировать службы HTTP[S], работающие на нестандартных портах. Например, Nessus способен идентифицировать их на произвольных портах (при условии, что ему поручено сканировать все порты), и в отличии от Nmap проведёт ряд тестов на известные уязвимости web-сервера, а также на конфигурацию SSL для HTTPS. Как указывалось ранее, Nessus также может обнаруживать популярные приложения или web-интерфейсы, которые в противном случае могли бы остаться незамеченными (например, административный интерфейс Tomcat).

### Подходы к решению проблемы 3 — виртуальные хосты

Есть несколько методов, которые можно использовать для идентификации DNS-имён, связанных с данным IP-адресом. `x.y.z.t`.

#### Передача DNS-зоны

В настоящее время этот метод применяется редко, учитывая, что передача зон почти не используется. Тем не менее, возможно, стоит попробовать. Прежде всего, тестировщики должны определить DNS-серверы, обслуживающие `x.y.z.t`. Если известно символьное имя для `x.y.z.t` (пусть это будет `www.example.com `), его серверы имён могут быть определены с помощью таких инструментов, как `nslookup`, `host` или `dig`, посредством запроса в DNS.

Если для `x.y.z.t` символьные имена не известны, но оно есть в определении цели, тестировщики могут попытаться применить тот же процесс и запросить сервер имён с этим именем (надеясь, что `x.y.z.t` также обслуживается этим DNS-сервером). Например, если цель определена через IP-адрес `x.y.z.t` и имя `mail.example.com`, определите DNS-сервер для домена `example.com`.

В следующем примере показано, как определить серверы имён для `www.owasp.org` с помощью команды `host`:

```bash
$ host -t ns www.owasp.org
www.owasp.org is an alias for owasp.org.
owasp.org name server ns1.secure.net.
owasp.org name server ns2.secure.net.
```

Теперь можно запросить передачу зоны на серверы имён для домена `example.com`. Если повезёт, запрос вернёт список записей DNS для этого домена. Он будет включать в себя очевидные `www.example.com` и не столь очевидное`helpdesk.example.com` и `webmail.example.com` (а, возможно, и другие). Проверьте все имена, выводимые при передаче зоны, и рассмотрите все те, что связаны с исследуемой целью.

Попытаемся запросить перенос зоны для `owasp.org` с одного из его серверов имён:

```bash
$ host -l www.owasp.org ns1.secure.net
Using domain server:
Name: ns1.secure.net
Address: 192.220.124.10#53
Aliases:

Host www.owasp.org not found: 5(REFUSED)
; Transfer failed.
```

#### Обратный DNS-запрос

Этот процесс аналогичен предыдущему, но основан на обратных записях DNS (Point to Reverse, PTR). Вместо того, чтобы запрашивать передачу зоны, попробуйте определить тип ресурсной записи PTR и запросить указанный IP-адрес (с помощью специального домена `in-addr.arpa` для IPv4 или `ip6.arpa` для IPv6). Если повезёт, запрос вернёт запись DNS-имени. Этот метод основан на существовании сопоставлений между IP-адресом и символьным именем, но они не являются обязательными.

#### Web-поиск в DNS

Этот вид поиска похож на передачу DNS-зоны, но опирается на web-службы, которые позволяют выполнять поиск по имени в DNS. Одной из таких служб является сервис [Netcraft Search DNS](https://searchdns.netcraft.com/?host). Тестер может запросить список имён, принадлежащих выбранному домену, например `example.com`. Затем он проверит, относятся ли полученные имена к цели, которую он исследует.

#### Обратный IP-запрос

Службы обратных IP-запросов аналогичны обратным запросам в DNS, с той разницей, что тестировщики запрашивают web-приложение, а не сервер имён. Таких сервисов существует несколько. Поскольку они, как правило, возвращают неполные (и часто разные) результаты, лучше использовать несколько сервисов, чтобы провести более полный анализ.

- [Domain Tools Reverse IP](https://www.domaintools.com/reverse-ip/) (требует бесплатной регистрации)
- [DNSstuff](https://www.dnsstuff.com/) (доступно несколько услуг)
- [Net Square](https://web.archive.org/web/20190515092354/http://www.net-square.com/mspawn.html) (несколько запросов по доменам и IP-адресам, требует установки)

#### Поиск в Google

После сбора информации с помощью предыдущих методов тестировщики могут полагаться на поисковые системы, чтобы, возможно, уточнить и расширить свой анализ. Это может привести к появлению дополнительных символьных имен, принадлежащих объекту исследования, или приложений, доступных по неочевидным URL-адресам.

Например, рассматривая предыдущий пример, касающийся `www.owasp.org`, тестер мог запросить Google и другие поисковые системы информацию (а следовательно, DNS-имена), связанную с недавно обнаруженными доменами `webgoat.org`, `webscarab.com`, и `webscarab.net`.

Методы поиска в Google описаны в разделе [Разведка в поисковых системах и обнаружение утечек информации](01-Conduct_Search_Engine_Discovery_Reconnaissance_for_Information_Leakage.md).

#### SSL-сертификаты

Если сервер принимает соединения по протоколу HTTPS, то в сертификате общее (Common Name, CN) и альтернативное имя субъекта (Subject Alternate Name, SAN) могут содержать одно или несколько имён хостов. Однако, если web-сервер не имеет доверенного сертификата или используются символы подстановки (wildcard), он может не возвращать достоверной информации.

CN и SAN можно увидеть, проверяя сертификат вручную или с помощью других инструментов, таких как OpenSSL:

```sh
openssl s_client -connect 93.184.216.34:443 </dev/null 2>/dev/null | openssl x509 -noout -text | grep -E 'DNS:|Subject:'

Subject: C = US, ST = California, L = Los Angeles, O = Internet Corporation for Assigned Names and Numbers, CN = www.example.org
DNS:www.example.org, DNS:example.com, DNS:example.edu, DNS:example.net, DNS:example.org, DNS:www.example.com, DNS:www.example.edu, DNS:www.example.net
```

## Инструменты

- Инструменты поиска в DNS, такие как `nslookup`, `dig` и т.п.
- Поисковые системы (Google, Bing и другие).
- Специализированные web-службы поиска в DNS: см. [Netcraft Search DNS](https://searchdns.netcraft.com/?host).
- [Nmap](https://nmap.org/)
- [Nessus Vulnerability Scanner](https://www.tenable.com/products/nessus)
- [Nikto](https://www.cirt.net/nikto2)
