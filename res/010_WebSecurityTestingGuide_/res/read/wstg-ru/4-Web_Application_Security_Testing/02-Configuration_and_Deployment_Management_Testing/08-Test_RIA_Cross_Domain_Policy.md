---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование междоменной политики для RIA

|ID          |
|------------|
|WSTG-CONF-08|

## Обзор

Насыщенные интернет-приложения (англ.: [Rich Internet Applications](https://ru.wikipedia.org/wiki/%D0%9D%D0%B0%D1%81%D1%8B%D1%89%D0%B5%D0%BD%D0%BD%D0%BE%D0%B5_%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5), RIA) — технологии, почти не используемые современными браузерами; их место заняли [SPA](https://ru.wikipedia.org/wiki/%D0%9E%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5) и [PWA](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B5%D1%81%D1%81%D0%B8%D0%B2%D0%BD%D0%BE%D0%B5_%D0%B2%D0%B5%D0%B1-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5). Чтобы обеспечить контролируемый междоменный доступ к данным и сервисам, работающим на таких технологиях, как Oracle Java, MS Silverlight и Adobe Flash, в RIA используются файлы политики Adobe crossdomain.xml. Следовательно, домен может предоставить удалённый доступ к своим службам из другого домена. Однако часто файлы политик, описывающие ограничения доступа, не настроены. Неправильная конфигурация этих политик делает возможными атаки с подделкой межсайтовых запросов и может позволить третьим лицам получить доступ к конфиденциальным данным, предназначенным для пользователя.

### Что такое файлы междоменной политики?

Файл междоменной политики определяет разрешения, которые web-клиент, такой как Java, Adobe Flash, Adobe Reader и т.д., использует для доступа к данным в разных доменах. Для Silverlight Microsoft использовала подмножество Adobe crossdomain.xml и дополнительно создала собственный файл междоменной политики: clientaccesspolicy.xml.

Всякий раз, когда web-клиент обнаруживает, что ресурс должен быть запрошен из другого домена, он сначала ищет файл политики в целевом домене, чтобы определить, разрешено ли выполнение междоменных запросов, включая заголовки, и соединения на основе сокетов.

Главный (master) файл политики расположен в корне домена. Клиенту может быть указано загрузить другой файл политики, но он всегда сначала проверяет главный, чтобы убедиться, что он разрешает запрошенный файл политики.

#### Сравнение Crossdomain.xml и Clientaccesspolicy.xml

Большинство приложений RIA поддерживают crossdomain.xml. Однако в случае с Silverlight это будет работать только в том случае, если в файле crossdomain.xml указано, что доступ разрешён из любого домена. Для более точной настройки в Silverlight необходимо использовать clientaccesspolicy.xml.

Файлы политики предоставляют несколько типов разрешений:

- Принятые файлы политики (главные файлы политики могут отключать или ограничивать другие файлы политики)
- Разрешения для сокетов
- Разрешения для заголовков
- Разрешения на доступ по HTTP/HTTPS
- Разрешение доступа с использованием криптографических учётных данных

Пример файла политики с явно избыточными разрешениями:

```xml
<?xml version="1.0"?>
<!DOCTYPE cross-domain-policy SYSTEM
"http://www.adobe.com/xml/dtds/cross-domain-policy.dtd">
<cross-domain-policy>
    <site-control permitted-cross-domain-policies="all"/>
    <allow-access-from domain="*" secure="false"/>
    <allow-http-request-headers-from domain="*" headers="*" secure="false"/>
</cross-domain-policy>
```

### Как можно злоупотреблять файлами междоменной политики?

- Чрезмерно разрешительные междоменные политики.
- Формирование ответов сервера, которые могут интерпретироваться как файлы междоменной политики.
- Использование функции загрузки файлов для загрузки файлов, которые могут интерпретироваться как файлы междоменной политики.

### Последствия от злоупотребления междоменным доступом

- Обход защиты от CSRF.
- Ограничения на чтение данных или иная защита в cross-origin-политиках.

## Задача тестирования

- Проанализировать и подтвердить настройки в файлах политик.

## Как тестировать

### Тестирование на наличие недостатков в файлах политики RIA

Чтобы проверить наличие недостатков в файлах политики RIA, тестировщик должен попытаться получить файлы политики crossdomain.xml и clientaccesspolicy.xml из корня приложения и из каждой найденной папки.

Например, если URL приложения `http://www.owasp.org`, тестировщик должен попытаться загрузить файлы `http://www.owasp.org/crossdomain.xml` и `http://www.owasp.org/clientaccesspolicy.xml`.

После извлечения всех файлов политики все предоставленные разрешения должны быть проверены на соответствие принципу наименьших привилегий. Запросы должны поступать только от тех доменов, портов или протоколов, которые необходимы. Следует избегать чрезмерно разрешительной политики. Политики со `*` должны быть изучены с особым пристрастием.

#### Пример

```xml
<cross-domain-policy>
    <allow-access-from domain="*" />
</cross-domain-policy>
```

##### Ожидаемый результат

- Список найденных файлов политики.
- Перечень недостатков в политиках.

## Инструменты

- Nikto
- OWASP Zed Attack Proxy Project
- W3af

## Ссылки

- Adobe: [Спецификация файла междоменной политики](https://www.adobe.com/devnet-docs/acrobatetk/tools/AppSec/CrossDomain_PolicyFile_Specification.pdf)
- Adobe: [Рекомендации по использованию файлов междоменной политики](https://www.adobe.com/devnet-docs/acrobatetk/tools/AppSec/xdomain.html)
- Oracle: [Поддержка Cross-Domain XML](http://www.oracle.com/technetwork/java/javase/plugin2-142482.html#CROSSDOMAINXML)
- MSDN: [Обеспечение доступности сервиса за пределами домена](http://msdn.microsoft.com/en-us/library/cc197955(v=vs.95).aspx)
- MSDN: [Ограничения доступа в сетевой безопасности Silverlight](http://msdn.microsoft.com/en-us/library/cc645032(v=vs.95).aspx)
- Google Doctype: [Краткий обзор модели безопасности Flash](http://code.google.com/p/doctype-mirror/wiki/ArticleFlashSecurity)
- UCSD: [Анализ междоменных политик Flash-приложений](http://cseweb.ucsd.edu/~hovav/dist/crossdomain.pdf)
