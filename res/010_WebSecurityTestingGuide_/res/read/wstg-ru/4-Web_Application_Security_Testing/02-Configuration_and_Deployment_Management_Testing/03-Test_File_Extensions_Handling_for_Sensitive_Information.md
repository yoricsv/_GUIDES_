---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование обработки расширений файлов на наличие чувствительной информации

|ID          |
|------------|
|WSTG-CONF-03|

## Обзор

Расширения файлов обычно используются на web-серверах, чтобы легко определить, какие технологии, языки и плагины должны использоваться для выполнения web-запроса. Хотя такое поведение согласуется с RFC и web-стандартами, использование стандартных расширений файлов даёт специалисту по тестированию на проникновение полезную информацию о базовых технологиях, используемых в web-приложении, и значительно упрощает задачу определения сценария атаки, который будет использоваться для конкретных технологий. Кроме того, неправильная конфигурация web-серверов может легко раскрыть чувствительную информацию об учётных данных для доступа.

Проверка расширений часто используется перед загрузкой файлов, что может привести к неожиданным результатам, если содержимое не соответствует ожидаемому, или из-за неправильной обработки имени файла операционной системой.

Определение того, как web-серверы обрабатывают запросы к файлам с разными расширениями, может помочь понять их поведение в зависимости от типа файлов, к которым осуществляется доступ. Например, это может помочь понять, какие расширения файлов выдаются в виде простого текста, а какие вызывают выполнение на стороне сервера. Последние указывают на технологии, языки или плагины, которые используются web-серверами или серверами приложений, и могут дать дополнительную информацию о том, как спроектировано web-приложение. Например, расширение .pl обычно связано с поддержкой Perl на стороне сервера. Однако само по себе расширение файла может быть обманчивым и не вполне убедительным. Например, ресурсы Perl на стороне сервера могут быть переименованы, чтобы скрыть факт связи с Perl. См. раздел «Компоненты web-сервера» для дополнительной информации по идентификации серверных технологий и компонентов.

## Задачи тестирования

- Проанализировать чувствительные расширения файлов или расширения, которые могут содержать «сырые» данные (*например*, скрипты, учётные данные и т.д.).
- Убедиться, что в наборе правил нет обхода системной платформы.

## Как тестировать

### Перебор файлов и каталогов

Направляйте запросы с разными расширениями файлов и проверяйте, как они обрабатываются. Проанализируйте каждый web-каталог. Найдите каталоги, в которых разрешено выполнение скрипта. Каталоги web-сервера можно определить с помощью инструментов сканирования, которые ищут наличие известных каталогов. Кроме того, реконструировать дерево web-каталогов, обслуживаемых приложением, позволяет зеркалирование структуры web-сайта (погуглите "web mirroring tools").

Если в архитектуре web-приложения предусмотрена балансировка по нагрузке, важно оценить все указанные на ней web-серверы. Это может оказаться простой или не очень задачей, в зависимости от конфигурации инфраструктуры балансировки. В инфраструктуре с избыточными компонентами могут быть небольшие различия в конфигурации отдельных web-серверов или серверов приложений. Это может произойти, если в архитектуре используются разнородные технологии (например, сервера IIS наряду с Apache в конфигурации с балансировкой нагрузки, что может привести к небольшой асимметрии в поведении между ними и, возможно, к различным уязвимостям).

#### Пример

Тестировщик обнаружил файл `connection.inc`. Попытка прямого доступа к нему выдаёт его содержимое, т.е.:

```php
<?
    mysql_connect("127.0.0.1", "root", "password")
        or die("Could not connect");
?>
```

Тестировщик определяет наличие серверной части СУБД MySQL и учётные данные, используемые web-приложением для доступа к ней.

Файлы со следующими расширениями никогда не должны выдаваться web-сервером, поскольку они могут содержать чувствительную информацию, и передавать их браузеру не имеет смысла:

- `.asa`
- `.inc`
- `.config`

Следующие расширения файлов относятся к файлам, которые при доступе либо отображаются, либо загружаются браузером. Поэтому файлы с такими расширениями должны быть проверены, дабы убедиться, что они действительно нужны для работы приложения (а не забыты в процессе разработки) и что они не содержат чувствительной информации:

- `.zip`, `.tar`, `.gz`, `.tgz`, `.rar` и т.д.: (сжатые) архивные файлы
- `.java`: нет причин предоставлять доступ к исходным файлам Java
- `.txt`: текстовые файлы
- `.pdf`: документы pdf
- `.docx`, `.rtf`, `.xlsx`, `.pptx`и т.д.: офисные документы
- `.bak`, `.old` и другие расширения, указывающие на файлы резервных копий (например, `~` для резервных копий Emacs)

Приведённый выше список содержит лишь несколько примеров, поскольку расширений файлов слишком много, чтобы рассматривать их здесь все. Обратитесь к [FILExt](https://filext.com/) - более подробной базе данных расширений.

Для определения файлов по заданным расширениям можно использовать сочетание методов. Эти методы могут включать в себя сканеры уязвимостей, инструменты поиска и зеркалирования, ручную проверку приложения (чтобы преодолеть ограничения автоматического сканирования), запросы к поисковым системам (см. раздел [Разведка в поисковых системах и обнаружение утечек информации](../01-Information_Gathering/01-Conduct_Search_Engine_Discovery_Reconnaissance_for_Information_Leakage.md)). См. также [Анализ старых резервных копий и файлов без ссылок](04-Review_Old_Backup_and_Unreferenced_Files_for_Sensitive_Information.md) в котором рассматриваются проблемы безопасности, связанные с «забытыми» файлами.

### Загрузка файла

Для обхода фильтров загрузки файлов иногда используется устаревшее соглашение о наименовании имён файлов Windows 8.3.

Примеры использования:

1. `file.phtml` обрабатывается как код PHP.
2. `FILE~1.PHT` загружается, но не обрабатывается PHP ISAPI.
3. `shell.phPWND` может быть загружен.
4. `SHELL~1.PHP` будет развёрнут оболочкой ОС, а затем обработан PHP ISAPI.

### Тестирование методом «серого ящика»

Проведение тестирования обработки расширений файлов методом «белого ящика» сводится к проверке конфигураций web-серверов или серверов приложений, участвующих в архитектуре web-приложений, и проверке того, как им предписано обрабатывать различные расширения файлов.

Если web-приложение использует разнородную инфраструктуру с балансировкой нагрузки, определите, может ли это привести к различиям в поведении.

## Инструменты

Сканеры уязвимостей, такие как Nessus и Nikto, проверяют наличие известных web-каталогов. Они позволяют загрузить структуру web-сайта, что полезно при попытке определить конфигурацию web-каталогов и то, как обрабатываются отдельные расширения файлов. Другие инструменты, которые можно использовать для этой цели, включают:

- [wget](https://www.gnu.org/software/wget)
- [curl](https://curl.haxx.se)
- Погуглите "web mirroring tools".
