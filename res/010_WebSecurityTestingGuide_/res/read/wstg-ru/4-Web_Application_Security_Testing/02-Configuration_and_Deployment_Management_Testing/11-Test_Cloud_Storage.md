---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование облачного хранилища

|ID          |
|------------|
|WSTG-CONF-11|

## Обзор

Облачные службы хранения данных облегчают web-приложениям и сервисам хранение и доступ к объектам. Однако некорректная настройка контроля доступа может привести к раскрытию конфиденциальной информации, подмене данных или несанкционированному доступу.

Известным примером является некорректная конфигурация корзин (англ.: bucket) Amazon S3, хотя другие службы облачного хранения также могут подвергаться подобным рискам. По умолчанию все корзины S3 являются закрытыми и могут быть доступны только пользователям, которым явно предоставлен доступ. Пользователи могут предоставить общий доступ как к самой корзине, так и к отдельным объектам, хранящимся в ней. Это может привести к тому, что неавторизованный пользователь сможет загружать туда файлы, изменять или читать сохранённые файлы.

## Задача тестирования

- Убедиться в корректности настроек конфигурации контроля доступа для служб хранения.

## Как тестировать

Сначала определите URL-адрес для доступа к данным в службе хранения, а затем проведите следующие тесты:

- чтение неавторизованных данных
- загрузка произвольного файла

Вы можете использовать curl для тестов со следующими командами и посмотреть, можно ли выполнить несанкционированные действия.

Чтобы проверить возможность прочитать объект:

```bash
curl -X GET https://<cloud-storage-service>/<object>
```

Чтобы проверить возможность загрузки файла:

```bash
curl -X PUT -d 'test' 'https://<cloud-storage-service>/test.txt'
```

### Тестирование некорректной конфигурации корзины Amazon S3

URL-адреса корзины Amazon S3 соответствуют одному из двух форматов: либо в стиле виртуального хоста, либо в стиле пути.

- URL в формате виртуального хоста

```text
https://bucket-name.s3.Region.amazonaws.com/key-name
```

В следующем примере `my-bucket` — это имя корзины, `us-west-2` — регион, а `puppy.png`— имя ключа:

```text
https://my-bucket.s3.us-west-2.amazonaws.com/puppy.png
```

- URL в формате пути

```text
https://s3.Region.amazonaws.com/bucket-name/key-name
```

Как и выше, в следующем примере `my-bucket` — имя корзины, `us-west-2` — регион, а `puppy.png` — имя ключа:

```text
https://s3.us-west-2.amazonaws.com/my-bucket/puppy.jpg
```

Для некоторых регионов можно использовать устаревшую глобальную точку входа, в которой не указан конкретный регион. Её формат также либо в стиле виртуального хоста, либо в стиле пути.

- URL в формате виртуального хоста

```text
https://bucket-name.s3.amazonaws.com
```

- URL в формате пути

```text
https://s3.amazonaws.com/bucket-name
```

#### Определение URL корзины

Для тестирования методом «чёрного ящика» URL-адреса S3 можно найти в сообщениях HTTP. В следующем примере показано, что URL-адрес корзины передаётся в теге `img` HTTP-ответа.

```html
...
<img src="https://my-bucket.s3.us-west-2.amazonaws.com/puppy.png">
...
```

Для тестирования методом «серого ящика» вы можете найти URL-адреса корзин в web-интерфейсе Amazon, документах, исходном коде или других доступных источниках.

#### Тестирование в AWS-CLI

Помимо curl, вы также можете пользоваться инструментом командной строки AWS. В этом случае используется протокол `s3://`.

##### Просмотр содержимого

Следующая команда выведет перечень всех объектов в корзине, если она настроена как общедоступная.

```bash
aws s3 ls s3://<bucket-name>
```

##### Загрузка

Ниже приведена команда для загрузки файла.

```bash
aws s3 cp arbitrary-file s3://bucket-name/path-to-save
```

В этом примере показан результат успешной загрузки.

```bash
$ aws s3 cp test.txt s3://bucket-name/test.txt
upload: ./test.txt to s3://bucket-name/test.txt
```

В этом примере показан результат, когда загрузка не удалась.

```bash
$ aws s3 cp test.txt s3://bucket-name/test.txt
upload failed: ./test2.txt to s3://bucket-name/test2.txt An error occurred (AccessDenied) when calling the PutObject operation: Access Denied
```

##### Удаление

Ниже приведена команда для удаления объекта.

```bash
aws s3 rm s3://bucket-name/object-to-remove
```

## Инструменты

- [Интерфейс командной строки AWS](https://aws.amazon.com/cli/)

## Ссылки

- [Обзор корзин Amazon S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html)
- [flAWS 2](http://flaws2.cloud)
